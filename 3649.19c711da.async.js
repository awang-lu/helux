!(function(){"use strict";var Pf=Object.defineProperty,xf=Object.defineProperties;var Nf=Object.getOwnPropertyDescriptors;var mt=Object.getOwnPropertySymbols;var ao=Object.prototype.hasOwnProperty,uo=Object.prototype.propertyIsEnumerable;var co=(L,P,C)=>P in L?Pf(L,P,{enumerable:!0,configurable:!0,writable:!0,value:C}):L[P]=C,b=(L,P)=>{for(var C in P||(P={}))ao.call(P,C)&&co(L,C,P[C]);if(mt)for(var C of mt(P))uo.call(P,C)&&co(L,C,P[C]);return L},N=(L,P)=>xf(L,Nf(P));var io=(L,P)=>{var C={};for(var T in L)ao.call(L,T)&&P.indexOf(T)<0&&(C[T]=L[T]);if(L!=null&&mt)for(var T of mt(L))P.indexOf(T)<0&&uo.call(L,T)&&(C[T]=L[T]);return C};var fo=(L,P,C)=>new Promise((T,X)=>{var ye=Y=>{try{he(C.next(Y))}catch(W){X(W)}},Ve=Y=>{try{he(C.throw(Y))}catch(W){X(W)}},he=Y=>Y.done?T(Y.value):Promise.resolve(Y.value).then(ye,Ve);he((C=C.apply(L,P)).next())});(self.webpackChunkhelux_docs=self.webpackChunkhelux_docs||[]).push([[3649],{73649:function(L,P,C){C.r(P),C.d(P,{$:function(){return sf},action:function(){return ef},addMiddleware:function(){return kf},addPlugin:function(){return Cf},atom:function(){return Ri},atomx:function(){return Ti},block:function(){return nf},createShared:function(){return _i},cst:function(){return Of},defineDeriveFnItem:function(){return ki},defineDeriveTask:function(){return Fi},derive:function(){return Mi},deriveDict:function(){return wi},dynamicBlock:function(){return rf},emit:function(){return yf},flush:function(){return Ef},getActionLoading:function(){return bf},getAtom:function(){return Ff},getDeriveLoading:function(){return If},getMutateLoading:function(){return Tf},getRawState:function(){return Mf},getSnap:function(){return wf},init:function(){return gf},isAtom:function(){return vf},isDerivedAtom:function(){return Sf},isDiff:function(){return _f},markRaw:function(){return Df},model:function(){return df},modelFactory:function(){return pf},mutate:function(){return of},mutateDict:function(){return cf},on:function(){return hf},produce:function(){return Rf},reactiveDesc:function(){return mf},runDerive:function(){return Ci},runDeriveTask:function(){return Oi},runMutate:function(){return af},runMutateTask:function(){return uf},shallowCompare:function(){return Af},share:function(){return bi},sharex:function(){return Ii},signal:function(){return tf},storeSrv:function(){return Kf},sync:function(){return ff},syncer:function(){return lf},useActionLoading:function(){return Xi},useAtom:function(){return Pi},useAtomX:function(){return xi},useDerived:function(){return Vi},useEffect:function(){return Wi},useGlobalForceUpdate:function(){return qi},useGlobalId:function(){return Bi},useLayoutEffect:function(){return zi},useLocalForceUpdate:function(){return Qi},useMutable:function(){return ji},useMutateLoading:function(){return $i},useObject:function(){return Zi},useOnEvent:function(){return Hi},useReactive:function(){return Ni},useReactiveX:function(){return Ui},useService:function(){return Gi},useStable:function(){return Ji},useWatch:function(){return Yi},watch:function(){return Li}});function T(e,t){e.includes(t)||e.push(t)}function X(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}function ye(e){return Array.from(new Set(e))}function Ve(e,t){let n=!1;for(const r of e)if(t.includes(r)){n=!0;break}return n}function he(e,t){let n="";const r=e.length;for(let s=0;s<r;s++){const o=e[s];if(t.startsWith(o)){n=o;break}}return n}function Y(e,t){if(!e)return[];const n=e(t);return Array.isArray(n)?n:[n]}var W=function(){if(typeof globalThis!="undefined")return globalThis;if(typeof global!="undefined")return global;if(typeof window!="undefined")return window;if(this!==void 0)return this;throw new Error("no globalThis")}(),Mn=!1;function w(...e){}var lo=w;function po(...e){return e}function ge(...e){return[]}function Uf(...e){}var yo=Object.prototype.toString,ho="[object Map]";function Vf(){return!(typeof window!="undefined"&&window.document)}function Et(e){return yo.call(e)===ho}function wn(e){return e===Number.MAX_SAFE_INTEGER}function se(){return!(!Mn&&W.name!=="previewFrame"&&!W.BrowserFS)}function j(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Fn(e){return e&&typeof e=="object"}function F(e){return typeof e=="function"}function Yf(e){return Mn?Object.prototype.toString.call(e)==="[object AsyncFunction]":!0}function vt(e){return typeof e=="symbol"}function St(e){if(!e)return!1;const t=typeof e;return(t==="object"||t==="function")&&F(e.then)}function Bf(e){try{return e.test,!1}catch(t){return!0}}function Ke(){return typeof Proxy=="function"}function oe(e,t){var i;const{throwErr:n=!1,prefixLabel:r="",suffixLabel:s=", see details in console.",logErr:o=!0,alertErr:c}=t||{};let a=e,u=!1;if(e instanceof Error&&(u=!0,a=e.message),(c!=null?c:se())&&e&&((i=W.alert)==null||i.call(W,`${r}${a}${s}`)),o&&console.error(e),n)throw u?e:new Error(String(e))}function me(e,t=0){t===0?(console.error(e),se()&&console.trace(e)):t===1?console.error(e):console.warn(e)}function Ae(e){return wn(e)?1:e+1}var go=!!Reflect,mo=Object.prototype.hasOwnProperty;function Eo(e,t){return go?Reflect.has(e,t):mo.call(e,t)}function De(e,t,n){let r=e[t];return r||(r=e[t]=n),r}function Ye(e,t,n){let r=e.get(t);return r||(e.set(t,n),r=n),r}function kn(e,t){let n="";for(const r in e)if(t.startsWith(r)){n=r;break}return n}function Cn(e,t){const n=e.get(t);if(n!==void 0)return n;const r=e.get(Number(t)||t);return r!==void 0?r:void 0}function ce(e,t){let n,r=e;return t.forEach(s=>{n=Et(r)?Cn(r,s):r[s],r=n}),n}function On(e,t,n){let r=e;const s=t.length-1;t.forEach((o,c)=>{const a=Et(r);if(c===s)return void(a?r.set(o,n):r[o]=n);r=a?Cn(r,o):r[o]})}function vo(){return me("changing shared state is invalid"),!0}function Gf(e){return e}function Kt(e,t){return`${t}/${e}`}function At(e){return e&&Ke()}var So=Object.defineProperty,Dt={};((e,t)=>{for(var n in t)So(e,n,{get:t[n],enumerable:!0})})(Dt,{useEffect:()=>_o,useEffectLogic:()=>Rt,useForceUpdate:()=>Ln,useLayoutEffect:()=>Do,useObject:()=>To,useObjectLogic:()=>xn,useStable:()=>Pn});var Ko=0,Be=new Map,_t=0;function Ao(e,t){const n=()=>{const r=t();return()=>{Be.delete(e),r&&r()}};if(function(r){_t||(_t=r)}(e),function(r){const s=Be.get(r);s?s.count+=1:Be.set(r,{count:1})}(e),_t%2!=0)return n();{const r=function(s){return Be.get(s)}(e);if(r&&r.count>1)return n()}}function Rt(e,t,n){const{useState:r,useLayoutEffect:s,useEffect:o}=e.react,{isLayout:c,deps:a}=n,[u]=r(()=>++Ko);(c?s:o)(()=>Ao(u,t),a)}function Do(e,t,n){Rt(e,t,{isLayout:!0,deps:n})}function _o(e,t,n){Rt(e,t,{deps:n})}function Ln(e){const[,t]=e.react.useState({});return()=>t({})}function Ro(e){const{data:t}=e.current;F(t)?e.current.wrap=(...n)=>e.current.data(...n):j(t)?e.current.wrap=function(n,r){if(!Ke()){const o={};return Object.keys(n).forEach(c=>{const a=n[c];F(a)?o[c]=(...u)=>r.current.data[c](...u):Object.defineProperty(o,c,{get:()=>r.current.data[c],set(u){r.current.data[c]=u}})}),o}const s={};return new Proxy(n,{get(o,c){const a=o[c];return F(a)?De(s,c,(...u)=>r.current.data[c](...u)):a}})}(t,e):e.current.wrap=t}function Pn(e,t){const{useRef:n,useMemo:r}=e.react,s=n({data:t,wrap:{},inited:!1});return s.current.data=r(()=>t,[t]),s.current.inited||(Ro(s),s.current.inited=!0),s.current.wrap}function xn(e,t,n,r){const{useState:s,useRef:o,useEffect:c}=e.react,[a]=s(t),u=Ln(e),i=o({state:null,unmount:!1,shouldCopy:!0}),l=Pn(e,{setState(f){const d=i.current;if(d.unmount)return;let y;const{state:m}=d;n?(y=n(f,d.state||a),r&&y?(d.state=y,d.shouldCopy=!1):d.shouldCopy=!0):(y=(F(f)?f(m):f)||{},d.shouldCopy=!0),Object.assign(a,y||{}),u()},getLatestState(){const f=i.current;return f.shouldCopy&&(f.state=b({},a),f.shouldCopy=!1),f.state}});return c(()=>{const f=i.current;return f.unmount=!1,()=>{f.unmount=!0}},[i]),[a,l.setState,l]}function To(e,t){return xn(e,t)}function bo(e){const t={},n={react:e},r=Dt;return Object.keys(Dt).forEach(s=>{t[s]=r[s].bind(null,n)}),t}var G=C(71664),Io=Object.defineProperty,Mo=(e,t)=>{for(var n in t)Io(e,n,{get:t[n],enumerable:!0})},Nn={};Mo(Nn,{$:()=>pi,action:()=>ds,addMiddleware:()=>Jo,addPlugin:()=>ec,atom:()=>ju,atomx:()=>$u,block:()=>ii,createShared:()=>di,cst:()=>yi,currentDraftRoot:()=>Ic,defineDeriveFnItem:()=>du,defineDeriveTask:()=>lu,derive:()=>gs,deriveDict:()=>fu,dynamicBlock:()=>qs,emit:()=>sc,flush:()=>nn,getActionLoading:()=>Tu,getAtom:()=>Xn,getDeriveLoading:()=>Ba,getMutateLoading:()=>_u,getRawState:()=>lc,getSnap:()=>ur,init:()=>zo,isAtom:()=>Te,isDerivedAtom:()=>ae,isDiff:()=>li,markRaw:()=>G.Xl,mutate:()=>Ks,mutateDict:()=>mn,on:()=>oc,produce:()=>G.Uy,reactiveDesc:()=>Cr,runDerive:()=>Na,runDeriveTask:()=>Ua,runMutate:()=>vs,runMutateTask:()=>Ss,shallowCompare:()=>fi,share:()=>_n,sharex:()=>Hu,signal:()=>eo,storeSrv:()=>Fu,sync:()=>Xu,syncer:()=>Wu,useActionLoading:()=>bu,useAtom:()=>As,useAtomX:()=>Ds,useDerived:()=>vn,useGlobalForceUpdate:()=>bs,useGlobalId:()=>Du,useLocalForceUpdate:()=>Fs,useMutable:()=>ks,useMutateLoading:()=>Ru,useOnEvent:()=>Iu,useReactive:()=>Kn,useReactiveX:()=>Cs,useService:()=>wu,useWatch:()=>Cu,watch:()=>nu});var Un="4.0.1",wo=G.TT,Tt={ON_DATA_CHANGED:"ON_DATA_CHANGED",ON_SHARE_CREATED:"ON_SHARE_CREATED",ON_ERROR_OCCURED:"ON_ERROR_OCCURED"},bt={NO:"no",PRIVATE:"private",GLOBAL:"global"},Vn=0,Yn=Symbol,Fo=typeof Yn=="function";function Q(e){return Fo?Yn(e):(Vn+=1,`__HELUX_SYMBOL_${Vn}__`)}var ko="__proto__",Co=Ke(),Oo=Q("HeluxUndefined"),Bn=Q("HeluxMutateFnItem"),Ge=Q("HeluxFnKey"),He=Q("HeluxSharedKey"),Gn=Q("HeluxReactiveMeta"),It=Q("HeluxIsBlock"),_e=Q("HeluxIsAtom"),je=Q("HeluxIsDerivedAtom"),$e=[He,_e,je,It],Xe="SingleMutate",Lo="HeluxGlobalLoading",Po=6,xo=!0,Hn=2e3,No=20,Re="1",Mt="2",We=1,ze=2,jn=3,Ee="|",Je={TASK:"task",MAY_TRANSFER:"may_transfer"},q={STATIC:"static",HOOK:"hook"},J={USER_STATE:"user_state",GLOGAL_EMPTY:"global_empty",GLOGAL_LOADING:"global_loading",PRIVATE_LOADING:"private_loading"},Uo="derive",$n="watch",Ze="Object",Vo="Map",Yo="Array",Bo="Other",B={SET_STATE:"SetState",MUTATE:"Mutate",ACTION:"Action",REACTIVE:"Reactive",LOADING:"Loading",SYNC:"Sync"};function Te(e){var t;return e&&(t=e[_e])!=null?t:!1}function ae(e){return e&&e[je]||!1}function Xn(e){return Te(e)||ae(e)?e.val:e}function Go(){return{keySeed:{static:0,hook:0,Reactive:0,Mutate:0},runningFnKey:"",runningSharedKey:0,isIgnore:!1,depKeys:[],GID_INSKEYS_MAP:new Map,FNKEY_STATIC_CTX_MAP:new Map,FNKEY_HOOK_CTX_MAP:new Map,DEPKEY_FNKEYS_MAP:new Map,UNMOUNT_INFO_MAP:new Map,DEPKEY_COMPUTING_FNKEYS_MAP:new Map}}function Ho(){return{keySeed:0,keyPrefix:0,initCount:0,mountedCount:0,latest:{val:null,stateOrResult:null,sharedKey:0,depKey:"",keyPath:[],isDerivedResult:!1,isDerivedAtom:!1},runningKey:"",isDynamic:!1,KEY_CTX_MAP:new Map,KEY_DYNAMIC_CTX_MAP:new Map}}function jo(){return{keySeed:0,UNMOUNT_INFO_MAP:new Map}}function $o(){return{keySeed:0,SHARED_KEY_STATE_MAP:new Map,STATE_SHARED_KEY_MAP:new Map,INTERMAL_MAP:new Map,COMPARE_MAP:new Map,isStateChanged:!1}}function Wn(){const e={};return{on:(t,n)=>{De(e,t,[]).push(n)},emit:(t,...n)=>{(e[t]||[]).slice().forEach(s=>s(...n))},off:(t,n)=>{const r=e[t]||[],s=r.findIndex(o=>o===n);s>=0&&r.splice(s,1)},canEmit:t=>e[t]}}function zn(){const e={VER:Un,LIMU_VER:G.TT,rootState:{},setState:(t,n)=>{const r=e.ctx.mod[t];if(!r)throw new Error(`moduleName ${t} not found`);r.setState(n)},ctx:{bus:Wn(),userBus:Wn(),mod:{},middlewares:[],plugins:[],sharedScope:$o(),fnScope:Go(),insScope:jo(),blockScope:Ho(),markAtomMap:new Map,renderSN:0,globalLoading:null,globalLoadingInternal:null,globalEmpty:null,globalEmptyInternal:null,isRootRender:!0},legacyRoot:{}};return e}var Qe={},Jn=!1,Zn=null,Qn=!1;function U(){return Qe.ctx||{}}function Xo(){return Qe}function qn(e){Qe=e.ROOT,Zn=e.api,Jn=e.inited}function Wo(){return{ROOT:Qe,inited:Jn,API:Zn}}function zo(e){if(Qn)return!1;Qn=!0;const{isRootRender:t=!0}=e;return U().isRootRender=t,!0}function Jo(e){const{middlewares:t}=U();t.push(e)}function Zo(e,t,n,r){const{middlewares:s}=U();if(!s.length)return;const o={},{sharedKey:c,moduleName:a,forAtom:u}=e,l={forAtom:u,draftRoot:t,draft:n,sharedKey:c,moduleName:a,setData:(f,d)=>o[f]=d,data:o,idx:0,sn:r};s.forEach((f,d)=>{f(N(b({},l),{idx:d}))})}var{ON_DATA_CHANGED:wt,ON_SHARE_CREATED:er,ON_ERROR_OCCURED:Qo}=Tt,qo=[J.GLOGAL_LOADING,J.PRIVATE_LOADING];function ec(e){const{plugins:t,bus:n}=U();t.push(e);const r={on:(s,o)=>n.on(s,o),onStateChanged:s=>n.on(wt,s)};e.install(r)}function tc(e,t){const{bus:n}=U();if(n.canEmit(wt)){const{from:r,desc:s}=t,{sharedKey:o,moduleName:c,snap:a,usefulName:u,stateType:i}=e;let l;qo.includes(i)?l=`${u}/setState`:l=`${u}@${r||"Api"}/${s}`,n.emit(wt,{snap:a,sharedKey:o,moduleName:c,type:l})}}function nc(e){const{bus:t}=U();if(t.canEmit(er)){const{snap:n,sharedKey:r,moduleName:s,usefulName:o}=e,c=`${o}@FactoryApi/createShared`;t.emit(er,{snap:n,sharedKey:r,moduleName:s,type:c})}}function tr(e,t,n){const{bus:r}=U();if(!r.canEmit(t))return!1;const{sharedKey:s,moduleName:o}=e;return r.emit(t,{moduleName:o,sharedKey:s,data:n}),!0}function nr(e,t){tr(e,Qo,{err:t})||(console.warn("found uncaught error, sugguest add a plugin to handle this error"),console.error(t))}function rc(){const{userBus:e}=U();return e}function sc(e,...t){const{userBus:n}=U();n.emit(e,...t)}function oc(e,t){const{userBus:n}=U();return n.on(e,t),()=>n.off(e,t)}function cc(e,t){return e.__proto__=t,e}function ac(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n]);return e}var Ft=Object.setPrototypeOf||({__proto__:[]}instanceof Array?cc:ac);function uc(e){const t=Object.create(null);return Ft(t,b({},Object.prototype)),e&&Object.assign(t,e),t}function rr(e){if(F(e))return;const t=Object.create(null);return Ft(t,Object.prototype),Ft(e,t),e}function sr(e,t,n){return e[t]=n,!0}function or(e,t){return e[t]}function be(e,t){const{set:n=sr,get:r=or,obj:s={}}=t||{};return Object.keys(e).forEach(o=>{Object.defineProperty(s,o,{enumerable:!0,configurable:!1,set:function(c){return n(e,o,c)},get:function(){return r(e,o)}})}),s}function ue(e,t){const{set:n=sr,get:r=or}=t||{};if(Ke())return new Proxy(e,{set(c,a,u){return n(c,a,u)},get(c,a){return r(c,a)}});const s=uc();return be(s,{obj:s,set:n,get:r})}var Ie=U();function qe(e){const n=U()[e];return Ie[e]=n,n}function Z(){return Ie.blockScope||qe("blockScope")}function x(){return Ie.fnScope||qe("fnScope")}function ee(){return Ie.sharedScope||qe("sharedScope")}function cr(){return Ie.insScope||qe("insScope")}function ar(){const{INTERMAL_MAP:e}=ee();return e}function ic(e,t){if(!e||!se()||!t)return;const{INTERMAL_MAP:n,SHARED_KEY_STATE_MAP:r,STATE_SHARED_KEY_MAP:s}=ee();let o=[],c=!1;if(n.forEach(a=>{a.moduleName===e&&a.loc===t&&a.stateType===J.USER_STATE&&o.push(a.sharedKey)}),o.length>1){const a=o[0],u=n.get(a);n.delete(a),u&&(r.delete(u.sharedKey),s.delete(u.rawState))}return c}function Me(e){return ar().get(e)}function V(e){const t=te(e);return Me(t)}function fc(e,t){const n=ar(),r=te(e);n.set(r,t)}function lc(e){return V(e).rawState}function ur(e,t=!0){const n=V(e);return t?n.prevSnap:n.snap}function te(e){return e&&(e[He]||ee().STATE_SHARED_KEY_MAP.get(e))||0}function dc(e){const t=ee(),{STATE_SHARED_KEY_MAP:n}=t,r=Ae(t.keySeed);return n.set(e,r),t.keySeed=r,r}function pc(e,t){const{SHARED_KEY_STATE_MAP:n,STATE_SHARED_KEY_MAP:r}=ee();n.set(e,t),r.set(t,e)}function yc(e){return ee().SHARED_KEY_STATE_MAP.get(e)}function hc(e,t){const{rootState:n,ctx:r}=Xo(),{moduleName:s,usefulName:o}=t,c=n[o],a=V(c);if(s&&a&&a.loc!==t.loc){const u=`
loc1:${a.loc} 
loc2:${t.loc}`;return me(`only-dev-mode tip: moduleName ${s} duplicate! this does not effect helux but the duplicated module will be ignored by devtool`+u)}n[o]=e,r.mod[o]=V(e)}var gc={innerSetState:w};function ir(e,t){const{rawState:n,forAtom:r}=e,s=new Map,o={},c={},a=[],u=b({},n);let i=u;return r&&(i=n.val),N(b(b({ver:0,sn:0,reactive:n,reactiveRoot:n,sync:w,syncer:w,snap:u,prevSnap:u,rawStateVal:i},e),t),{insCtxMap:s,key2InsKeys:o,id2InsKeys:c,recordId(l,f){if(!l)return;const d=De(c,l,[]);T(d,f)},delId(l,f){l&&X(c[l]||[],f)},recordDep(l,f){const d=De(o,l,[]);T(d,f)},delDep(l,f){X(o[l]||[],f)},mapInsCtx(l,f){s.set(f,l)},delInsCtx(l){s.delete(l)},extra:{},loadingInternal:gc,level1ArrKeys:a})}var mc={Mutate:"",Reactive:"r",[q.STATIC]:"s",[q.HOOK]:"h"};function Ec(){const e=cr(),t=Ae(e.keySeed);return e.keySeed=t,t}function vc(){const e=Z(),{keySeed:t,keyPrefix:n}=e,r=Ae(t);e.keySeed=r;let s=n;return wn(t)&&(s=Ae(n),e.keyPrefix=s),`${s}_${r}`}function Sc(){const e=U(),t=e.renderSN,n=t===Number.MAX_VALUE?1:t+1;return e.renderSN=n,n}function kt(e){const t=mc[e],r=x().keySeed,s=Ae(r[e]);return r[e]=s,`${t}${s}`}function Kc(){return kt("Reactive")}var{MAY_TRANSFER:Ac}=Je,{SET_STATE:Dc,REACTIVE:_c}=B,Rc=()=>({isReplaced:!1,replacedValue:null}),Tc=()=>{},bc=Ot({isFake:!0});function fr(e,t,n=w){const{desc:r="",onRead:s,from:o=_c,depKeys:c=[],isTop:a=!1,expired:u=!1,insKey:i=0}=t;return{draft:e,finish:n,modified:!1,expired:u,sharedKey:0,moduleName:"",hasFlushTask:!1,nextTickFlush:w,data:[],isTop:a,key:"",fnKey:"",depKeys:c,writeKeys:[],desc:r,onRead:s,from:o,insKey:i}}function Ct(e){const{ids:t=[],globalIds:n=[],isReactive:r=!1,from:s=Dc,enableDep:o=!1,handleCbReturn:c=!0,sn:a=Sc(),isFirstCall:u=!1,desc:i="",onRead:l}=e;return{fnKey:"",depKeys:[],forcedDepKeys:[],triggerReasons:[],ids:t,globalIds:n,readKeys:{},writeKeys:{},arrKeyDict:{},writeKeyPathInfo:{},handleCbReturn:c,draftVal:null,from:s,isReactive:r,enableDep:o,sn:a,isFirstCall:u,desc:i,onRead:l}}function we(e,t,n){const{isChanged:r=!0,parentKeyPath:s=[],op:o="set",parentType:c="Object"}=n,a=s.slice();return a.push(e),{isChanged:r,isCustom:!1,op:o,immutBase:!1,key:e,value:t,proxyValue:t,parentType:c,keyPath:s,fullKeyPath:a,isBuiltInFnKey:!1,replaceValue:w,getReplaced:Rc}}function Ot(e){const f=e||{},{desc:t="",fn:n=w,task:r=Tc,depKeys:s=[],writeKeys:o=[],deps:c=ge,isFake:a=!1,onlyDeps:u=!1}=f,i=io(f,["desc","fn","task","depKeys","writeKeys","deps","isFake","onlyDeps"]);return b({fn:n,task:r,deps:c,oriDesc:"",onlyDeps:u,desc:t,depKeys:s,writeKeys:o,checkDeadCycle:void 0,watchKey:"",isFake:a,enabled:!0},i)}function lr(){const e={fnKey:"",fn:w,subFnInfo:bc,checkDeadCycle:!0,isFirstLevel:!0,isExpired:!1,task:w,deps:ge,status:{loading:!1,err:null,ok:!0},forAtom:!1,remainRunCount:0,showLoading:!1,nextLevelFnKeys:[],prevLevelFnKeys:[],mountStatus:We,depKeys:[],depSharedKeys:[],result:{},fnType:"watch",returnUpstreamResult:!1,scopeType:"static",renderStatus:Re,proxyResult:{},updater:w,createTime:Date.now(),shouldReplaceResult:!1,isAsync:!1,isAsyncTransfer:!1,isSimpleWatch:!1,isRunning:!1,dcErrorInfo:{err:null,tipFn:w},asyncType:Ac,subscribe:t=>{t()},extra:{},setLoading:(t,n=null)=>{const r=!t&&!n;e.status={loading:t,err:n,ok:r}},renderInfo:{time:0,insKey:0,sn:0,getDeps:()=>e.depKeys.slice()}};return e}var dr={draftRoot:{val:null},isFake:!0,isAtom:!0},pr=Ct({}),et=fr(!0,{expired:!0}),Hf=Ot(),yr=ir({rawState:{},forAtom:!1,usefulName:""},{}),hr=lr(),tt=dr,Lt=pr,gr="",Pt=new Map,xt=new Map,Nt=new Map,Ut=w,Vt=[],Yt="";function Ic(){return tt}var Fe={current:()=>Yt,set:e=>Yt=e,del:()=>Yt=""},Bt={current:()=>Ut,set:e=>Ut=e,del:()=>Ut=w},ke={current:e=>xt.get(e)||"SetState",set:(e,t)=>xt.set(e,t),del:e=>xt.delete(e)},Ce={current:()=>Vt,set:e=>Vt=e,del:()=>Vt=[]},ne={current:()=>Nt.get(gr)||et,markUsing:e=>gr=e,set:(e,t)=>Nt.set(e,t),del:e=>Nt.delete(e)},Gt={current:e=>Pt.get(e),set:(e,t)=>Pt.set(e,t),del:e=>Pt.delete(e)},nt={current:()=>tt,set:(e,t)=>{Object.assign(tt,{draftRoot:e,isAtom:t,isFake:!1})},del:()=>tt=dr},Ht={current:()=>Lt,set:e=>Lt=e,del:()=>Lt=pr};function jt(e){const{FNKEY_STATIC_CTX_MAP:t,FNKEY_HOOK_CTX_MAP:n}=x();return e[0]==="s"?t:n}function Mc(e,t){const{DEPKEY_COMPUTING_FNKEYS_MAP:n}=x();Ye(n,e,[]).push(t)}function wc(e,t){const{DEPKEY_COMPUTING_FNKEYS_MAP:n}=x(),r=n.get(e);r&&X(r,t)}function Fc(e){const{DEPKEY_FNKEYS_MAP:t}=x(),{depKeys:n,fnKey:r}=e;n.forEach(s=>{const o=t.get(s)||[];X(o,r)})}function mr(e,t){const{FNKEY_STATIC_CTX_MAP:n}=x(),{fnKey:r,prevLevelFnKeys:s}=e;s.forEach(o=>{var a;const c=(a=n.get(o))==null?void 0:a.nextLevelFnKeys;c&&(t?T(c,r):X(c,r))})}function kc(){const{FNKEY_HOOK_CTX_MAP:e}=x();se()&&e.forEach(t=>{t.isExpired=!0})}function Er(e,t,n){const r=n||kt(t);return F(e)?e[Ge]=r:(rr(e),e.__proto__[Ge]=r),r}function vr(e){return F(e)?e[Ge]||"":j(e)&&e.__proto__[Ge]||""}function ie(e){return jt(e).get(e)}function $t(e){return jt(e).get(e)||hr}function Oe(e){const t=vr(e);return ie(t)||null}function rt(){const{runningFnKey:e,depKeys:t,runningSharedKey:n,isIgnore:r}=x();return{fnCtx:e?ie(e):null,depKeys:t,isIgnore:r,runningSharedKey:n}}function Cc(){return x().runningFnKey}var{USER_STATE:Oc}=J;function Lc(e,t=8){let n="";if(se()&&e)try{throw new Error("loc")}catch(r){const s=r.stack.split(`
`),o=s[1]||"";o.includes("webpack-internal")||o.includes("/node_modules/")?n=s.slice(0,16).join(" -> "):n=s.map(a=>a.substring(0,a.indexOf("(")).trim()).slice(4,t).join(" -> ")}return n}function Sr(e){const[t,n]=e.split("/"),r=n.split(Ee);return{sharedKey:Number(t),keyPath:r,depKey:e}}function Kr(e){const{sharedKey:t,forAtom:n}=e,r=n?"/val":"",s=n?["val"]:[];return{depKey:`${t}${r}`,keyPath:s,sharedKey:t}}function H(e,t){try{return Kt(e.join(Ee),t)}catch(n){return console.warn("found Symbol key in your path :",e),`${t}`}}function Pc(e,t){const{snap:n,prevSnap:r,stateType:s}=e;if(Oc!==s)return!0;const{keyPath:o}=Sr(t);try{const c=ce(n,o),a=ce(r,o);return c!==a}catch(c){return!0}}function xc(e,t){return Ke()?(0,G.OA)(e,{onOperate:t,compareVer:!0}):ue(e,{get(n,r){const s=n[r],o=we(r,s,{isChanged:!1,parentKeyPath:[]});return t(o),s}})}function Nc(e,t){if(t!==void 0){if(e)return{val:t};if(j(t))return t}}function Uc(e,t,n){const r=F(t)?t(n):t;return Nc(e,r)}function st(e,t){let{value:n}=e;if(t){t(e);const{replacedValue:r,isReplaced:s}=e.getReplaced();s&&(n=r)}return n}function Ar(e){return[Yo,Vo].includes(e)}function Vc(e){return Array.isArray(e)||Et(e)}var{isObject:fe,getDataType:Dr}=G.limuUtils;function _r(e,t){if(e===t)return e;const r=t.substring(e.length+1).split(Ee);return`${e}${Ee}${r[0]}`}function Yc(e,t){he(e,t)||T(e,t)}var Xt=new Map;function Rr(e,t){let n=!1;const{depKey:r,keyPath:s,sharedKey:o}=e,{stopDepInfo:c,level1ArrKeys:a,recordCb:u}=t,i=Xt.get(r);if(i)return u(i),!0;const{keys:l,isArrDict:f,depth:d,arrKeyStopDcit:y,stopArrDep:m}=c,p=he(a,r),g=s.length>d;if(g||p){let S="",D=d;return p&&(D=d+1,y[p]===!1||m&&(g?S=H(s.slice(0,D),o):S=_r(p,r))),S||(S=H(s.slice(0,D),o)),p||Xt.set(r,S),u(S),!0}const v=String(o);for(const S of l){if(!r.startsWith(S)||S===v)continue;const D=f[S],I=D?_r(S,r):S;D||Xt.set(r,I),u(I),n=!0;break}return n}function Wt(e,t){const n=Z(),{runningKey:r}=n;if(r){const{KEY_DYNAMIC_CTX_MAP:s,KEY_CTX_MAP:o,isDynamic:c}=n,u=(c?s:o).get(r);if(u){const{results:i,depKeys:l}=u;t?T(i,t):e.forEach(f=>T(l,f))}}}function ot(e,t){const n=ee(),{COMPARE_MAP:r}=n;let s=r.get(t);return s!==void 0?s:e.sharedKeyStr===t?n.isStateChanged:(s=Pc(e,t),r.set(t,s),s&&(n.isStateChanged=!0),s)}function Tr(e,t,n){if(t.includes(n)&&ot(e,n))return!0;let r=!1;for(const s of t)s.startsWith(n)&&ot(e,s)&&(r=!0);return r}function Bc(){const e=ee();e.COMPARE_MAP.clear(),e.isStateChanged=!1}function zt(e=!0){const t=x();t.isIgnore=e}function ve(e,t){const{fnCtx:n,depKeys:r,isIgnore:s}=rt(),o=t.specificCtx||n;if(!o){Bt.current()(e);return}const{DEPKEY_FNKEYS_MAP:c}=x(),{belongCtx:a,sharedKey:u}=t;if(u&&T(o.depSharedKeys,u),n&&a){n.isFirstLevel=!1,a.isAsync&&(n.isAsync=!0);const l=a.fnKey;T(o.prevLevelFnKeys,l),T(a.nextLevelFnKeys,n.fnKey)}const{fnKey:i}=o;e.forEach(l=>{if(ko===l||s)return;n&&T(r,l);const f=Ye(c,l,[]);T(f,i)})}function Jt(e){e&&e.depKeys.forEach(t=>ve([t],{specificCtx:e}))}function br(e){const{FNKEY_HOOK_CTX_MAP:t,UNMOUNT_INFO_MAP:n}=x(),{fnKey:r}=e;t.set(r,e),mr(e,!0);let s=n.get(r);s?s.c=2:(s={c:1,t:Date.now(),prev:0},n.set(r,s));const{c:o}=s;if(o===2){const c=ie(r);Jt(c)}}function Ir(e){let t="";return e.depSharedKeys.forEach(n=>{var s;const r=((s=Me(n))==null?void 0:s.ver)||0;t+=`${r}_`}),t}function Gc(e,t,n){const{DEPKEY_FNKEYS_MAP:r}=x(),s=r.get(t)||[],o=[],c=[];return s.forEach(a=>{const u=ie(a);if(u&&Tr(e,u.depKeys,t)){u.isFirstLevel&&o.push(a),u.isAsync&&c.push(a);const i=n[a];n[a]=i===void 0?1:i+1}}),{firstLevelFnKeys:o,asyncFnKeys:c}}function Zt(e){Fc(e),mr(e)}function Hc(){const{FNKEY_HOOK_CTX_MAP:e}=x();if(e.size>=No){const t=Date.now();e.forEach(n=>{const{mountStatus:r,createTime:s,fnKey:o}=n;[We,jn].includes(r)&&t-s>Hn&&(Zt(n),e.delete(o))})}}function Qt(e,t,n,r,s,o=!1,c=!1){const a=Z();a.latest={sharedKey:e,val:t,stateOrResult:n,depKey:r,keyPath:s,isDerivedResult:o,isDerivedAtom:c}}function jc(){return Z().latest}function Mr(e){const{KEY_DYNAMIC_CTX_MAP:t,KEY_CTX_MAP:n}=Z();return e?t:n}function wr(){return me("changing shared state is invalid"),!0}function ct(e,t,n,r,s){return r===_e?e?t:!1:r===He?n:s}function qt(e,t,n){e.replaceValue(ct(e.keyPath.length===0,t,n,e.key,e.value))}function $c(e){let t={};const{rawState:n,sharedKey:r,forAtom:s,onRead:o,isPrimitive:c,stopDepth:a}=e,u=(l,f)=>{const d=H(l,r);ve([d],{sharedKey:r}),Wt([d]),Qt(r,f,t,d,l)};if(Co)t=(0,G.OA)(n,{customKeys:$e,onOperate:l=>{const{isBuiltInFnKey:f,isCustom:d}=l;if(d)return qt(l,s,r);if(!f){const{fullKeyPath:y}=l,m=st(l,o);u(y,m)}},compareVer:!0});else{const l=(f,d,y)=>be(f,{set:wr,get:(m,p)=>{const g=m[p];if($e.includes(p))return ct(d===1,s,r,p,g);const v=we(p,g,{isChanged:!1,parentKeyPath:y});if(d<a&&fe(g))return l(g,d+1,v.fullKeyPath);const S=st(v,o);return u(v.fullKeyPath,S),S}});t=l(n,1,[])}let i=t;return s&&(c?i=n.val:i=ue(n,{set:wr,get:(l,f)=>t.val[f]})),pc(r,t),{sharedRoot:t,sharedState:i}}var Fr=null;function en(){return Fr}function Xc(e,t){const n=U();let r=n.globalEmpty;if(!r){const{stateRoot:s}=t({apiCtx:e,rawState:{},forGlobal:!0,stateType:J.GLOGAL_EMPTY}),o=V(s);n.globalEmpty=s,n.globalEmptyInternal=o}return Fr=r,r}function tn(e){const{GID_INSKEYS_MAP:t}=x();return Ye(t,e,[])}function Wc(){return U().globalEmptyInternal}function kr(e,t){if(!e)return;const n=tn(e);T(n,t)}function zc(e,t){if(!e)return;const n=tn(e);X(n,t)}var{REACTIVE:Jc}=B,Le=new Map;function Zc(e){return!!(e&&!e.expired&&e.modified)}function Qc(e){const{sharedKey:t}=e;e.expired=!0,ne.del(e.key);const n=ke.current(t);return ke.del(t),e.finish(null,{desc:n})}function Cr(e,t){const n=te(e);return t&&ke.set(n,t),n}function nn(e,t){const n=te(e);Pe(n,t)}function qc(){const e=ne.current();e.isTop&&Pe(e.sharedKey,e.desc)}function Pe(e,t){const n=Le.get(e);Zc(n)&&(t&&ke.set(e,t),Qc(n))}function ea(e){const t=Le.get(e)||et;t.expired=!0}function ta(e,t){const n=Le.get(e)||et;n.modified=!0,n.nextTickFlush(t)}function na(e,t){const{from:n=Jc,onRead:r}=t,{finish:s,draftRoot:o}=e.setStateFactory({isReactive:!0,from:n,handleCbReturn:!1,enableDep:!0,onRead:r}),c=fr(o,t,s);return c.key=Kc(),c.sharedKey=e.sharedKey,c.nextTickFlush=a=>{const{expired:u,hasFlushTask:i}=c;u||(c.data=[a]),i||(c.hasFlushTask=!0,Promise.resolve().then(()=>{const[l]=c.data;Pe(e.sharedKey,l)}))},c}function Or(e,t,n){const{sharedKey:r}=e,{insKey:s=0,from:o}=t;let c=Le.get(r)||et;c.expired&&(c=na(e,{isTop:!0,from:o}),Le.set(r,c),ne.set(c.key,c),ne.markUsing(c.key),c.fnKey=Fe.current()),c.onRead=s?t.onRead:void 0;const{draft:a}=c;return{val:n?a.val:a,meta:c}}function rn(e,t){let n={},r={};const{rawState:s,deep:o,forAtom:c,isPrimitive:a,sharedKey:u}=e;if(At(o)){const i={[He]:u,[_e]:c},l=(d,y,m)=>{const{val:p}=Or(e,t,d);return p[y]=m,!0},f=(d,y,m)=>{const p=m[y];if(p!==void 0)return p;const{val:g,meta:v}=Or(e,t,d);return Gn===y?v:g[y]};if(n=new Proxy(s,{set:(d,y,m)=>l(!1,y,m),get:(d,y)=>f(!1,y,i)}),r=n,c){const d=N(b({},i),{[_e]:!1});r=a?s.val:new Proxy(s.val,{set:(y,m,p)=>l(!0,m,p),get:(y,m)=>f(!0,m,d)})}}else n=s,r=s.val;return{draftRoot:n,draft:r}}function ra(e){const{UNMOUNT_INFO_MAP:t}=cr(),{insKey:n,readMap:r,internal:s}=e;s.mapInsCtx(e,n);let o=t.get(n);o?(o.c=2,o.prev=n-1):(o={c:1,t:Date.now(),prev:0},t.set(n,o));const{c}=o;c===2&&Object.keys(r).forEach(a=>{s.recordDep(a,n)})}function Lr(e){const{readMap:t,insKey:n,internal:r}=e;Object.keys(t).forEach(s=>r.delDep(s,n)),r.delInsCtx(n)}function sa(e){const{canCollect:t,isFirstRender:n,currentDepKeys:r}=e;if(!t){n&&(e.depKeys=r.slice());return}e.depKeys=r.slice()}function oa(e){const{canCollect:t}=e;t&&(e.readMap={},e.delReadMap={},e.depKeys=e.currentDepKeys.slice(),e.currentDepKeys.length=0)}function Pr(e,t,n){if(!e.canCollect)return;const{parentType:r,rawVal:s}=n,o=Vc(s);o&&Yc(e.internal.level1ArrKeys,t.depKey),e.recordDep(t,r,o)}function sn(e,t){const{depKeys:n,currentDepKeys:r,fixedDepKeys:s}=e;return(t?r:n).concat(s)}function ca(e){if(!e)return;const{updater:t,mountStatus:n,createTime:r}=e;if(n===We){Date.now()-r>Hn?Lr(e):e.needEFUpdate=!0;return}t()}function xr(e){const{internal:t,isReactive:n,insKey:r}=e,{rawState:s,isDeep:o,sharedKey:c,onRead:a,forAtom:u}=t;if(o){const i=l=>{const{isBuiltInFnKey:f,key:d}=l;if(f)return;if(vt(d))return qt(l,u,c);const{fullKeyPath:y,keyPath:m,parentType:p}=l,g=st(l,a),S={depKey:H(y,c),keyPath:y,parentKeyPath:m,sharedKey:c};Pr(e,S,{parentType:p,rawVal:g})};if(n){const{draft:l,draftRoot:f}=rn(t,{onRead:i,insKey:r});e.proxyState=f,e.proxyStateVal=l}else e.proxyState=(0,G.OA)(s,{onOperate:i,compareVer:!0})}else e.proxyState=ue(s,{set:()=>(me("changing shared state is invalid"),!0),get:(i,l)=>{const f=i[l];if(vt(l))return ct(!0,u,c,l,f);const d=st(we(l,f,{isChanged:!1,parentKeyPath:[]}),a),y=Kt(l,c),m=fe(i)?Ze:Bo;return Pr(e,{depKey:y,keyPath:[l],sharedKey:c},{parentType:m,rawVal:d}),d}})}function aa(e){var k;const{updater:t,sharedState:n,id:r="",globalId:s="",collectType:o="every",deps:c,pure:a=!0,arrDep:u=!0,isReactive:i=!1}=e,l=u&&(k=e.arrIndexDep)!=null?k:!0,f=V(n);if(!f)throw new Error("ERR_OBJ_NOT_SHARED: input object is not a result returned by share api");const d=Ec(),{rawState:y,isDeep:m,ver:p,ruleConf:g,level1ArrKeys:v,forAtom:S,sharedKey:D,sharedKeyStr:I,snap:R}=f,{stopDepInfo:K}=g,_={readMap:{},delReadMap:{},pure:a,depKeys:[],fixedDepKeys:[],currentDepKeys:[],isDeep:m,isReactive:i,insKey:d,internal:f,rawState:y,sharedState:n,sharedKey:D,proxyState:{},proxyStateVal:{},updater:t,mountStatus:We,renderStatus:Re,needEFUpdate:!1,createTime:Date.now(),rootVal:null,ver:p,id:r,globalId:s,collectType:o,canCollect:o!=="no",isFirstRender:!0,subscribe:E=>{E()},extra:{},getDeps:()=>sn(_,!0),renderInfo:{setDraft:f.insSetDraft,time:Date.now(),sn:0,snap:R,insKey:d,getDeps:()=>sn(_,!0),getPrevDeps:()=>sn(_,!1)},recordDep:(E,M,A)=>{let h=E.depKey;Rr(E,{stopDepInfo:K,level1ArrKeys:v,recordCb:Ue=>{h=Ue}});const{renderStatus:O,fixedDepKeys:$}=_;if(O===Mt)return;const{readMap:z,insKey:Lf,currentDepKeys:In,delReadMap:ro}=_;ve([h],{}),Cc()&&(X(In,h),T(_.fixedDepKeys,h));const so=()=>{z[h]=1,f.recordDep(h,Lf),$.includes(h)||T(In,h)};if(!z[h]&&!ro[h]){const{parentKeyPath:Ue}=E;if(a&&M===Ze&&Ue){const gt=Ue.length?H(Ue,D):I;z[gt]&&(delete z[gt],ro[gt]=1,X(In,gt))}const oo=Ar(M);if(oo){l&&so();return}(!A||!oo&&u)&&so()}}};if(s&&kr(s,d),xr(_),f.mapInsCtx(_,d),f.recordId(r,d),F(c)){const E=S?_.proxyState.val:_.proxyState,M=Y(c,E),A=_.getDeps().slice();M.includes(E)&&A.push(f.rootValKey),_.fixedDepKeys=A}return _}function Nr(e){const{result:t,forAtom:n}=e;e.proxyResult=ue(t,{set:()=>(me("changing derived result is invalid"),!1),get:(r,s)=>je===s?n:(Re===e.renderStatus&&Jt(e),t[s])})}function ua(e){const{proxyState:t,internal:n,renderInfo:r,canCollect:s,isReactive:o}=e,{sharedKey:c,sharedKeyStr:a,insSetState:u,forAtom:i}=n;r.snap=n.snap,r.time=Date.now();const l=i?t.val:t;return e.isFirstRender&&(e.rootVal=l,Gt.set(e.rootVal,e)),!i&&s&&e.recordDep({depKey:a,keyPath:[],sharedKey:c},Ze),[o?t:l,u,r]}function ia(e,t){if(t&&!Te(e))throw new Error("useAtom only accept atom")}function fa(e){const{ver:t,internal:{ver:n}}=e;t!==n&&(e.ver=n,xr(e))}function la(e){e.mountStatus=ze;const{id:t,globalId:n,insKey:r}=e;e.internal.recordId(t,r),kr(n,r),ra(e)}function da(e){e.mountStatus=jn;const{id:t,globalId:n,insKey:r}=e;e.internal.delId(t,r),zc(n,r),Lr(e)}function pa(e,t){const n=V(t).sharedKey;return e.internal.sharedKey!==n}function at(e,t,n,r){if(U().isRootRender)try{const s=r||n;e.react.useSyncExternalStore(t,n,s)}catch(s){console.error(s)}}var ya=null;function Ur(e,t,n){const{hookImpl:r,react:s}=e,o=r.useForceUpdate(),c=s.useRef({ctx:ya});let a=c.current.ctx;return(!a||pa(a,t))&&(a=aa(b({updater:o,sharedState:t},n)),c.current.ctx=a),a}function Vr(e,t){e.react.useEffect(()=>(t.isFirstRender=!1,Gt.del(t.rootVal),t.collectType==="first"&&(t.canCollect=!1),t.needEFUpdate&&(t.needEFUpdate=!1,t.updater()),la(t),()=>{da(t)}),[t])}function ha(e,t,n,r){n.renderStatus=Re,oa(n),at(e,n.subscribe,()=>V(t).snap),e.react.useEffect(()=>{n.renderStatus=Mt,n.isFirstRender=!1,sa(n)})}function on(e,t,n={}){const r=Ur(e,t,n);return at(e,r.subscribe,()=>V(t).snap),Vr(e,r),r}function ut(e,t,n={}){const{forAtom:r}=n;ia(t,r);const s=Ur(e,t,n);return ha(e,t,s,n),Vr(e,s),fa(s),{tuple:ua(s),insCtx:s}}function Yr(e,t){const{forAtom:n,label:r,strict:s=!1}=t||{};let o;if(typeof e=="number"?o=Me(e):o=V(e),!o&&e){const a=e[Gn];o=Me(a==null?void 0:a.sharedKey)}let c=r?`[[${r}]] err:`:"err:";if(!o)if(s)oe(`${c} not a valid shared or atom`,{throwErr:!0});else return null;return n!==void 0&&(n&&!o.forAtom&&oe(`${c} expect a shared but recived a atom`,{throwErr:!0}),!n&&o.forAtom&&oe(`${c} expect a atom but recived a shared`,{throwErr:!0})),o}function le(e,t){return Yr(e,N(b({},t||{}),{strict:!0}))}var{MUTATE:ga,LOADING:ma}=B,{GLOGAL_LOADING:Ea,PRIVATE_LOADING:va}=J,{PRIVATE:Sa,GLOBAL:Ka}=bt,Br={},Aa={},Da={time:0,sn:0,getDeps:ge,getPrevDeps:ge,insKey:0,setDraft:w},_a=[de(Br,Aa,ga),w,Da];function Ra(e,t){const{internal:n,apiCtx:r}=t,{mutateFnDict:s,moduleName:o}=n,c={};Object.keys(s).forEach(i=>{c[i]={loading:!1,err:null,ok:!0}});const a=o?`${o}@Loading`:"";return e({apiCtx:r,rawState:c,isLoading:!0,stateType:va},{moduleName:a}).state}var Gr=null;function Ta(){return Gr}function Hr(){return U().globalLoadingInternal}function ba(e,t){const n=U();let r=n.globalLoading;if(!r){const{stateRoot:s}=t({apiCtx:e,rawState:{},stateType:Ea},{moduleName:Lo}),o=V(s);n.globalLoadingInternal=o,n.globalLoading=s}return Gr=r,r}function cn(e,t){let n=t;return vt(t)&&(n=t.toString()),`${e}>${n}`}function jr(e,t,n){if(!t)return;const{loadingInternal:r}=e;r.innerSetState(s=>{s[t]=n},{from:ma}),n.err&&(tr(e,Tt.ON_ERROR_OCCURED,{err:n.err}),console.error(n.err))}function de(e,t,n){let r=e[n];return r||(r=ue(t,{get(s,o){const c=cn(n,o);return s[c]||{loading:!1,ok:!0,err:null}}}),e[n]=r),r}function xe(e,t){const{internal:n,from:r}=t,{stateType:s,recordLoading:o}=n,c=J.USER_STATE===s;let a=de(Br,{},r),u={};if(c)if(Sa===o)u=n.extra.loadingProxy,u||(u=Ra(e,t),n.extra.loadingProxy=u,n.loadingInternal=V(u)),a=de(n.extra,u,r);else if(Ka===o){const i=Hr();u=Ta(),n.loadingInternal=i,a=de(i.extra,u,r)}else u=en();else u=n.sharedState,a=de(n.extra,u,r);return{loadingState:a,loadingProxy:u}}function $r(e,t){if(!fe(t))return e;const n=Object.keys(t);if(!n.length)return e;const r=t[n[0]];return r.__sharedKey?N(b({},e),{internal:le(r.__sharedKey)}):e}function Xr(e,t){const{internal:n,from:r,apiCtx:s}=t,{stateType:o}=n,c=J.USER_STATE===o;xe(e,t);let a=()=>_a;return c&&(a=u=>{const i=$r(t,u),l=xe(e,i).loadingProxy,{insCtx:{proxyState:f,internal:d,extra:y,renderInfo:m}}=ut(s,l);return[de(y,f,r),d.setState,m]}),{useLoading:a,getLoading:u=>{const i=$r(t,u);return xe(e,i).loadingState}}}function it(e){const t=lr();return Object.assign(t,e||{})}function Se(){const e=x(),{runningFnKey:t}=e;if(!t)return[];const n=ie(t);let r=[];if(n){const{depKeys:s}=e,{depKeys:o}=n,c={};s.forEach(u=>c[u]=1),s.forEach(u=>{const i=kn(c,u);i&&i!==u&&delete c[i]}),Object.keys(c).forEach(u=>T(o,u)),r=o.slice()}return e.runningFnKey="",e.depKeys=[],e.runningSharedKey=0,r}function Wr(e,t){const n=x();n.runningFnKey=e,n.runningSharedKey=t,n.isIgnore=!1}function zr(e,t){const{specificProps:n,fnCtxBase:r}=t,{scopeType:s}=n,o=Er(e,s),c=b({fn:e,fnKey:o},n),a=r?Object.assign(r,c):it(c);return jt(s).set(o,a),a}function an(e){var s;const{FNKEY_HOOK_CTX_MAP:t,UNMOUNT_INFO_MAP:n}=x(),{fnKey:r}=e;Zt(e),e.extra.deferedWatch=null,t.delete(r),((s=n.get(r))==null?void 0:s.c)===2&&n.delete(r),Hc()}function Jr(e){const{DEPKEY_COMPUTING_FNKEYS_MAP:t}=x(),{prevLevelFnKeys:n,depKeys:r}=e;let s=!1;for(const o of r){const c=t.get(o)||[];if(Ve(c,n)){s=!0;break}}return s}function Ia(e,t=!0,n=Ee){return e.map(r=>{const[s,o]=r.split("/"),c=o.split(Ee);return`${t?`${Me(Number(s)).usefulName}/`:""}${c.join(n)}`})}var ft=new Map,lt={WATCH:"1",MUTATE:"2"},Ma={[lt.WATCH]:"watch",[lt.MUTATE]:"mutate fn or task"};function wa(e=0){return{sn:e,descs:[],errs:[],timer:null,cycle:[]}}function Zr(e,t,n){const r=new Error(`DEAD_CYCLE: module(${e}) found mutate fn(${n}) in these dead cycle fns [${t.join(",")}]`);return r.cause="DeadCycle",r.data=t,r}function Fa(e){ft.delete(e)}function ka(e,t,n,r){const s=Ma[r],{desc:o,task:c,fn:a,isFake:u}=t.subFnInfo,i=o?`(${o})`:"",l=`DEAD_CYCLE: found reactive object in ${s}${i} cb is changing module(${e.usefulName})'s some of these dep keys(${Ia(n,!1,".")}), it will cause a infinity loop call!`,f=u?t.fn:c||a;return{err:new Error(`[only-dev-mode alert] ${l}`),tipFn:()=>console.error(` ${l} open the stack to find the below fn: 
`,f)}}function Ca(e,t,n){if(e&&n){const{usefulName:r}=e,s=Ye(ft,r,wa(t));s.sn!==t&&(s.descs=[],s.errs=[]);const{descs:o}=s;if(o.length>1&&o[0]===n){const c=o.slice();throw s.cycle=c,o.length=0,Zr(r,c,n)}T(o,n)}}function un(e,t){t.tipFn(),oe(t.err,{logErr:!1,throwErr:!1,alertErr:e.alertDeadCycleErr})}function pe(e,t,n){const{depKeys:r,subFnInfo:s}=t;let o=t.depKeys,c=n;r.length>n.length&&(o=n,c=r);let a=!1;if(Ve(o,c)){const u=s.desc?lt.MUTATE:lt.WATCH,i=ka(e,t,n,u);un(e,i),t.dcErrorInfo=i,a=!0}return a}function Oa(e,t){const n=ft.get(e);return!n||!n.cycle.includes(t)?{isIn:!1,cycle:[]}:{isIn:!0,cycle:n.cycle}}function La(e,t,n=!0){const r=ft.get(e);if(!r)return;const{timer:s,errs:o}=r;o.push(t),s&&clearTimeout(s),r.timer=setTimeout(()=>{let c=null;for(const a of o)c?a.data.length>c.data.length&&(c=a):c=a;c&&oe(c,{alertErr:n}),o.length=0},0)}function fn(e,t=0){const n=ie(e);n&&(n.showLoading&&(n.setLoading(!0),n.updater()),t&&(n.remainRunCount+=t))}var{MAY_TRANSFER:Pa}=Je;function xa(e,t){const{isFirstCall:n=!1,triggerReasons:r=[],sn:s=0,from:o,internal:c=yr,desc:a,fromFnKey:u}=t;if(e.dcErrorInfo.err){un(c,e.dcErrorInfo);return}if(e.fnKey===u){pe(c,e,e.depKeys);return}if(e.isSimpleWatch||!e.checkDeadCycle)return e.fn({isFirstCall:n,triggerReasons:r,sn:s});if(B.MUTATE===o&&Ca(c,s,a),e.isRunning&&pe(c,e,t.depKeys||[]))return;const i=ne.current();if(i.fnKey===e.fnKey&&pe(c,e,i.writeKeys)||(Pe(i.sharedKey,i.desc),e.isRunning===!0&&i.isTop&&pe(c,e,i.writeKeys)))return;e.isRunning=!0,Fe.set(e.fnKey);const f=e.fn({isFirstCall:n,triggerReasons:r,sn:s});Fe.del();const d=ne.current();if(!(d.isTop&&d.fnKey===e.fnKey&&pe(c,e,d.writeKeys))&&!(f&&f.task&&d.from===B.MUTATE&&pe(c,e,e.subFnInfo.writeKeys)))return e.isRunning=!1,f}function Ne(e,t={}){const{isFirstCall:n=!1,forceFn:r=!1,forceTask:s=!1,throwErr:o=!1,triggerReasons:c=[],sn:a=0,err:u,unbox:i=!1,internal:l=yr}=t,f=ie(e),d=(A=null)=>{if(A&&o)throw A;const h=f||hr;return i?[h.result.val,A]:[h.result,A]};if(!f)return d(new Error(`not a valid watch or derive cb for key ${e}`));if(f.fnType===$n)return xa(f,t);const{isAsync:y,fn:m,task:p,isAsyncTransfer:g,forAtom:v,result:S,depKeys:D}=f;f.remainRunCount>0&&(f.remainRunCount-=1);const I=A=>{const h=v?{val:A}:A;!f.returnUpstreamResult&&h&&Object.assign(f.result,h),f.shouldReplaceResult=!0},R=()=>{f.renderInfo.sn=a,f.updater()},K=A=>{const{data:h,err:O=null}=A;O?f.setLoading(!1,O):(I(h),n?y&&f.status.loading&&!Jr(f)&&f.setLoading(!1,O):f.remainRunCount===0&&f.setLoading(!1,O)),R(),f.nextLevelFnKeys.forEach($=>{Ne($,{isFirstCall:n,sn:a,triggerReasons:c,err:O})})},_=v?S.val:S,k=Y(f.deps),E={isFirstCall:n,prevResult:_,triggerReasons:c,input:k,sn:a};if(!y||r||y&&!p){const A=m(E);return K({data:A}),d()}if(y&&n&&f.nextLevelFnKeys.forEach(A=>fn(A,0)),g)return K({err:u}),d();if(f.asyncType===Pa){const A=m(E);return K({data:A}),d()}if(p){let A=lo;return n?(D.forEach(h=>Mc(h,e)),A=()=>D.forEach(h=>wc(h,e))):s&&f.nextLevelFnKeys.forEach(h=>fn(h)),Promise.resolve(()=>{const h=p(E);return St(h)?h:(oe("ERR_NON_FN: derive task arg should be async function!",{throwErr:o}),null)}).then(h=>h()).then(h=>(A(),K({data:h}),d())).catch(h=>{if(A(),K({err:h}),o)throw h;return nr(l,h),d(h)})}return d(u)}function dt(e,t){const n=Oe(e);if(!n)throw new Error("[Helux]: not a derived result");return Ne(n.fnKey,b({},t||{}))}function Na(e,t){return dt(e,{forceFn:!0,throwErr:t})}function Ua(e,t){return Promise.resolve(dt(e,{forceTask:!0,throwErr:t}))}function Va(e,t){return dt(e,{forceFn:!0,throwErr:t,unbox:!0})}function Ya(e,t){return Promise.resolve(dt(e,{forceTask:!0,throwErr:t,unbox:!0}))}function Ba(e){const t=Oe(e);return t?t.status:{loading:!1,err:null,ok:!0}}function ln(e,t,n){const r=e.get(t);r&&(r.renderInfo.sn=n,ca(r))}function Ga(e){const{mutateCtx:t,internal:n}=e,{ids:r,globalIds:s,depKeys:o,triggerReasons:c,isFirstCall:a,from:u,sn:i,desc:l,fnKey:f}=t,{key2InsKeys:d,id2InsKeys:y,insCtxMap:m,rootValKey:p}=n;let g=[],v=[],S=[],D=[];const I={};if(a){const K=Se();Ce.set(K)}const R=K=>{if(!ot(n,K))return;const _=d[K]||[],k=[];for(const A of _){if(g.includes(A))continue;const h=m.get(A);if(!h)continue;const O=h.getDeps();if(O[0]===p){ot(n,p)&&k.push(A);continue}Tr(n,O,K)&&k.push(A)}g=g.concat(k);const{firstLevelFnKeys:E,asyncFnKeys:M}=Gc(n,K,I);S=S.concat(E),D=D.concat(M)};if(o.forEach(K=>R(K)),o.includes(p)||R(p),Bc(),r.forEach(K=>{g=g.concat(y[K]||[])}),s.forEach(K=>{tn(K).forEach(_=>T(v,_))}),g=ye(g),S=ye(S),D=ye(D),D.forEach(K=>fn(K,I[K])),S.forEach(K=>Ne(K,{depKeys:o,sn:i,from:u,triggerReasons:c,internal:n,desc:l,isFirstCall:a,fromFnKey:f})),g.forEach(K=>ln(m,K,i)),v.length){const K=Wc().insCtxMap;v.forEach(_=>ln(K,_,i))}}function Ha(e){const{state:t,internal:n,mutateCtx:r}=e,{rawState:s,isDeep:o,ver:c,snap:a}=n;o?(n.prevSnap=c===0?b({},a):a,n.snap=t,Object.assign(s,t)):n.snap=b({},s),n.ver+=1,n.sn=r.sn,Ga(e)}var{MUTATE:ja}=B;function Qr(e,t){const{writeKey:n,ids:r,internal:s,opParams:o}=t,{snap:c}=s,{fullKeyPath:a,value:u}=o;Object.keys(e).forEach(i=>{n.startsWith(i)&&ce(c,a)!==u&&e[i].forEach(l=>T(r,l))})}function qr(e,t){const{isChanged:n,fullKeyPath:r,keyPath:s,parentType:o,value:c}=e,{internal:a,mutateCtx:u}=t,{arrKeyDict:i,isReactive:l,readKeys:f}=u,{sharedKey:d}=a,y=Ar(o),m=ne.current();if(e.op==="get"){y&&(i[H(s,d)]=1);const h=H(r,d);f[h]=1,u.enableDep&&(u.onRead&&u.onRead(e),m.onRead?m.onRead(e):(rt().fnCtx&&ve([h],{sharedKey:d}),l&&(Wt([h]),Qt(d,c,a.sharedState,h,r))));return}if(!n)return;const{moduleName:p,ruleConf:g,level1ArrKeys:v}=a,{writeKeyPathInfo:S,ids:D,globalIds:I,writeKeys:R}=u,K=H(r,d);if(m.key&&(m.isTop?T(m.writeKeys,K):m.from===ja&&T($t(m.fnKey).subFnInfo.writeKeys||[],K)),y){const h=H(s,d);S[h]={sharedKey:d,moduleName:p,keyPath:s},R[h]=1}const{hasIds:_,hasGlobalIds:k,stopDepInfo:E}=g;S[K]={sharedKey:d,moduleName:p,keyPath:r};const M=kn(i,K);M&&(R[M]=1),Rr({sharedKey:d,keyPath:r,depKey:K},{stopDepInfo:E,level1ArrKeys:v,recordCb:h=>{R[h]=1}})||(R[K]=1),_&&Qr(g.idsDict,{ids:D,writeKey:K,internal:a,opParams:e}),k&&Qr(g.globalIdsDict,{ids:I,writeKey:K,internal:a,opParams:e}),l?ta(d,m.desc):ea(d)}function es(e,t){Object.keys(t).forEach(n=>{e[n]=t[n]})}function pt(e,t){if(!t)return e;zt(!0);const n=e.val;return zt(!1),n}function ts(e){const{partial:t,forAtom:n,draftRoot:r,draftNode:s}=e;if(!t)return;if(!n){fe(t)&&es(s,t);return}const o=t.val;if(fe(s)){fe(o)?es(s,o):console.warn("dict atom deny to handle a non-dict returned value!");return}r.val=o}function $a(e,t){const{internal:n,mutateCtx:r}=e,s=pt(t,n.forAtom),{from:o,sn:c,desc:a}=r;n.before({from:o,draftRoot:t,draft:s,desc:a,sn:c}),Zo(n,t,s,c)}function ns(e,t,n,r){const{mutateCtx:s,internal:o}=e,{writeKeys:c,writeKeyPathInfo:a,handleCbReturn:u}=s,{forAtom:i}=o;u&&ts({partial:r,forAtom:i,draftRoot:t,draftNode:n}),$a(e,t),s.depKeys=Object.keys(c),nt.del(),Ht.del(),e.state=(0,G._x)(t),e.state!==o.rawState&&(s.triggerReasons=Object.values(a),Ha(e),tc(o,s))}function rs(e,t){const{ids:n,globalIds:r,from:s,desc:o,fnKey:c}=t;n&&n.forEach(a=>T(e.ids,a)),r&&r.forEach(a=>T(e.globalIds,a)),s&&(e.from=s),o&&(e.desc=o),c&&(e.fnKey=c)}function Xa(e){const{internal:t,setFactoryOpts:n}=e,{forAtom:r,rawState:s}=t,o=Ct(n),c=(0,G.P2)(s,{customKeys:$e,onOperate:u=>{if(u.isCustom)return qt(u,r,t.sharedKey);qr(u,{internal:t,mutateCtx:o})}});nt.set(c,r),Ht.set(o);const a=pt(c,r);return r&&(o.readKeys={}),{draftRoot:c,draftNode:a,finishMutate(u,i={}){rs(o,i),ns({state:{},mutateCtx:o,internal:t},c,a,u)}}}function Wa(e){return rr(e),dc(e)}function za(e){if(!e)return{};const{desc:t,ids:n,globalIds:r}=e;return{desc:t,ids:n,globalIds:r}}function Ja(e){const{forAtom:t=!1}=e;let n=e.rawState;const r=F(n);let s=!1;if(t)n=r?{val:n()}:{val:n},s=!n.val||!Fn(n.val);else{if(n=r?n():n,!j(n))throw new Error("ERR_NON_OBJ: pass an non-object to createShared!");if(te(n))throw new Error("ERR_ALREADY_SHARED: pass a shared object to createShared!")}return{isPrimitive:s,rawState:n}}function ss(e,t,n){let r=null,s=t||"";if(F(e)&&e!==w)r={[Bn]:1,fn:e,deps:ge,oriDesc:s,onlyDeps:!1,desc:s,depKeys:[],writeKeys:[],checkDeadCycle:void 0,watchKey:"",isFake:!1,enabled:!0};else if(j(e)){const{fn:o,desc:c,deps:a,task:u,immediate:i,checkDeadCycle:l,onlyDeps:f=!1}=e,d=t||c||"",y=F(o)?o:void 0,m=F(u)?u:void 0,p=F(a)?a:ge;(o||u)&&(r={[Bn]:1,checkDeadCycle:l,fn:y,watchKey:"",desc:d,oriDesc:d,deps:p,task:m,onlyDeps:f,immediate:i,depKeys:[],writeKeys:[],isFake:!1,enabled:!0})}if(r&&n){const{oriDesc:o}=r;(!o||n[o])&&(r.desc=kt(B.MUTATE))}return r}function os(e,t,n=!0){const r={},s=t||{};if(!e)return r;const o=(c,a)=>{const u=ss(c,a,s);u&&(u.enabled=n,r[u.desc]=u,s[u.desc]=u)};if(Array.isArray(e))if(e.length===1){const c=e[0],a=(j(c)?c.desc:"")||Xe;o(e[0],a)}else e.forEach(c=>o(c));else F(e)?o(e,Xe):j(e)&&Object.keys(e).forEach(c=>{o(e[c],c)});return r}function Za(e,t={}){var k,E,M,A,h;const{forAtom:n=!1,forGlobal:r=!1,stateType:s=J.USER_STATE}=e,{rawState:o,isPrimitive:c}=Ja(e),a=Wa(o),u=t.moduleName||"",i=(k=t.alertDeadCycleErr)!=null?k:se(),l=(E=t.deep)!=null?E:!0,f=(M=t.checkDeadCycle)!=null?M:!0,d=(A=t.enableMutate)!=null?A:!0,y=t.recordLoading||bt.PRIVATE,m=t.rules||[],p=t.before||w,g=t.mutate||w,v=(h=t.stopArrDep)!=null?h:!0,S=t.stopDepth||Po,D=`${a}`,I=n?`${a}/val`:D,R=u||D,K=Lc(u),_=os(g,{},d);return{isDestroyed:!1,alertDeadCycleErr:i,checkDeadCycle:f,rawState:o,sharedKey:a,sharedKeyStr:D,rootValKey:I,moduleName:u,usefulName:R,forAtom:n,forGlobal:r,loc:K,deep:l,rules:m,before:p,mutate:g,mutateFnDict:_,onRead:null,enableMutate:d,stateType:s,recordLoading:y,stopArrDep:v,stopDepth:S,isPrimitive:c}}function Qa(e){const{rawState:t,sharedKey:n,rootValKey:r,deep:s,rules:o,stopDepth:c,stopArrDep:a,forAtom:u}=e,i={},l={},f={keys:[],isArrDict:{},arrKeyStopDcit:{},depth:c,stopArrDep:a},d={},y=At(s);o.forEach(g=>{const v=[],{when:S,ids:D=[],globalIds:I=[],stopDep:R}=g;let K;if(y){let A="";K=(0,G.OA)(t,{onOperate:({fullKeyPath:h,value:O,isBuiltInFnKey:$})=>{if($)return;const z=H(h,n);A&&z.includes(A)&&v.pop(),v.push(z),d[z]=Array.isArray(O),A=z}})}else K=ue(t,{set:vo,get:(A,h)=>{const O=H([h],n);v.push(O);const $=A[h];return d[O]=Array.isArray($),$}});const _=u?K.val:K,k=Y(S,_),E=(A,h,O)=>{const $=De(A,O,[]);h.forEach(z=>T($,z))},M=A=>{E(i,D,A),E(l,I,A);let h;d[A]?(h=R!=null?R:xo,f.arrKeyStopDcit[A]=h,f.isArrDict[A]=d[A]):h=R!=null?R:!1,h&&T(f.keys,A)};v.forEach(M),k.includes(_)&&M(r)});const m=Object.keys(i).length>0,p=Object.keys(l).length>0;return{hasIds:m,idsDict:i,hasGlobalIds:p,globalIdsDict:l,stopDepInfo:f}}function qa(e){const{desc:t=Xe,strict:n=!1,throwErr:r=!1}={};return typeof e=="string"?{desc:e,strict:n,throwErr:r}:N(b({desc:t,strict:n},e),{throwErr:r})}function cs(e){var r;let t=w,n=!1;return F(e)?t=e:j(e)&&(t=e.deps||w,n=(r=e.immediate)!=null?r:!1),{immediate:n,deps:t}}function eu(e){return e?typeof e=="boolean"?{enableStatus:e}:j(e)?e:{}:{}}function tu(e){Array.isArray(e)&&e.forEach(t=>{const n=Gt.current(t),r=V(t)||(n==null?void 0:n.internal);if(r){const{depKey:s,sharedKey:o}=Kr(r);ve([s],{sharedKey:o})}n&&n.recordDep(Kr(r))})}function yt(e,t){const{scopeType:n,fnCtxBase:r,immediate:s,deps:o=w,label:c="watch",sharedState:a,isSimpleWatch:u}=t;if(!F(e))throw new Error(`ERR_NON_FN: pass an non-function to ${c}!`);const i=zr(e,{specificProps:{scopeType:n,fnType:$n,isSimpleWatch:u},fnCtxBase:r});Wr(i.fnKey,te(a));const l=o()||[];return tu(l),s&&e({isFirstCall:!0}),Se(),i}function nu(e,t){const{deps:n,immediate:r}=cs(t),s=yt(e,{scopeType:q.STATIC,deps:n,immediate:r});return{run:o=>Ne(s.fnKey,{throwErr:o}),unwatch:()=>Zt(s)}}var as=()=>{},dn=new Map;function us(e,t){const{forAtom:n,rawState:r}=e;return n?Y(t.deps,r.val):Y(t.deps,r)}function ru(e){var t;return(t=dn.get(e))!=null?t:!1}function pn(e,t){const{sn:n,getArgs:r=w,from:s,throwErr:o,isFirstCall:c,fnItem:a,mergeReturn:u}=t,{desc:i="",depKeys:l,task:f=as}=a,d=V(e),{sharedKey:y}=d,m={desc:i,sn:n,from:s},p=cn(s,i),{draft:g,draftRoot:v}=rn(d,{depKeys:l,desc:i,from:s}),S=h=>{Pe(y,h)},D=h=>{S(i);const{finish:O}=d.setStateFactory(m);return O(h)},I=B.MUTATE===s?us(d,a):[],R={isFirstCall:c,desc:i,setState:D,input:I,draft:g,draftRoot:v,flush:S},K=r(R)||[R],_=dn.get(f),k=_===void 0,E=(h,O,$)=>{(k||_)&&jr(d,p,{loading:h,err:O,ok:$})};E(!0,null,!1);const M=h=>{if(Ce.del(),E(!1,h,!1),o)throw h;return{snap:d.snap,err:h,result:null}},A=h=>(u&&h&&D(h),E(!1,null,!0),S(i),{snap:d.snap,err:null,result:h});try{const h=f(...K),O=St(h);return dn.set(f,O),O?Promise.resolve(h).then(A).catch(M):A(h)}catch(h){return M(h)}}function is(e,t){const{sn:n,getArgs:r=w,from:s,throwErr:o,isFirstCall:c=!1,fnItem:a}=t,{desc:u="",watchKey:i,fn:l=as}=a,f=B.MUTATE===s;f&&Fe.set(i);const d=V(e),{setStateFactory:y,forAtom:m,sharedState:p}=d,v={desc:u,sn:n,from:s,isFirstCall:c,enableDep:f&&c},S=E=>{const{finish:M}=y(v);return M(E)},D=pt(p,m),I=f?us(d,a):[],{draftNode:R,draftRoot:K,finish:_}=y(v),k=r({isFirstCall:c,draft:R,draftRoot:K,setState:S,desc:u,input:I})||[R,{input:I,state:D,draftRoot:K,isFirstCall:c}];try{const E=$t(a.watchKey);if(E.dcErrorInfo.err)return un(d,E.dcErrorInfo),{snap:d.snap,err:null,result:null};const M=l(...k);return _(M,{fnKey:E.fnKey}),fs(d,a,c),{snap:d.snap,err:null,result:null}}catch(E){if(fs(d,a,c),o)throw E;return{snap:d.snap,err:E,result:null}}}function fs(e,t,n){n&&!t.onlyDeps&&(rt().fnCtx?t.depKeys=Se():t.depKeys=Ce.current(),Ce.del());const r=ne.current();r.isTop&&r.fnKey===t.watchKey&&pe(e,$t(t.watchKey),r.writeKeys),Fe.del()}function su(e,t){var r;qc(),Ce.del(),zt(!1);const n=rt().fnCtx;n&&(n.subFnInfo=t,n.checkDeadCycle=(r=t.checkDeadCycle)!=null?r:e.checkDeadCycle,t.watchKey=n.fnKey),t.onlyDeps&&(t.depKeys=Se())}function yn(e){const{target:t,dict:n}=e,r=Object.keys(n);if(!r.length)return;const s=V(t),{mutateFnDict:o,usefulName:c,forAtom:a,sharedState:u}=s,i=l=>nr(s,l);r.forEach(l=>{const f=o[l];yt(({sn:d,isFirstCall:y})=>{if(y&&su(s,f),!s.enableMutate)return;const{desc:m,fn:p,task:g,immediate:v}=f,S=Oa(c,m);try{if(S.isIn)throw Zr(c,S.cycle,m);const D={sn:d,throwErr:!0,isFirstCall:y,fnItem:f,from:B.MUTATE};if(p&&(y||!g)&&is(t,D),g){y&&(f.depKeys=Se());const I=y&&(v!=null?v:!p);(!y||I)&&pn(t,D).catch(i)}return f}catch(D){D.cause==="DeadCycle"&&La(c,D,s.alertDeadCycleErr),i(D)}},{deps:()=>f.deps?f.deps(pt(u,a))||[]:[],sharedState:t,scopeType:q.STATIC,immediate:!0})})}var{ACTION:ls}=B;function ou(e,t){const{label:n,throwErr:r,desc:s="",task:o,mergeReturn:c=!0}=t,a=le(e,{label:n}),{forAtom:u}=a,i=(l,f)=>{const d=f!=null?f:r,y=Ot({desc:s,task:o,depKeys:[]}),m=(p,g)=>p.__action?p.__action(g):p(g);return pn(e,{fnItem:y,from:ls,mergeReturn:c,throwErr:d,getArgs:({draft:p,draftRoot:g,setState:v,desc:S,flush:D})=>[{draft:p,draftRoot:g,setState:v,desc:S,payload:l,flush:D,merge:R=>{ts({partial:R,forAtom:u,draftRoot:g,draftNode:p})},dispatch:m}]})};return jr(a,cn(ls,s),{loading:!1,ok:!0,err:null}),i.__sharedKey=a.sharedKey,i.__fnName=s,i.__task=o,o.__action=i,i}function ds(e){return t=>(n,r="",s)=>ou(e,{task:n,desc:r,label:"action",mergeReturn:t,throwErr:s})}var{TASK:ps}=Je,{STATIC:cu,HOOK:au}=q;function ys(e,t,n){if(!n&&(!j(t)||St(t)))throw new Error("ERR_NON_OBJ: derive,deriveAsync expect result to be a plain object");const{isAsync:r,isAsyncTransfer:s}=e;if(r&&!s){const o=vr(t),c=te(t);if(o&&e.fnKey!==o||c)throw new Error("ERR_INVALID_CALL: derive,deriveAsync can not transfer another derived result or shared state, it will cause wrong result")}}function uu(e,t){const n=ue(e.result,{set:()=>(me("changing derived result is invalid"),!1),get:(r,s)=>{if(s===je)return t;const o=r[s];return ve(e.depKeys,{belongCtx:e}),Wt(e.depKeys,n),Qt(0,o,n,"",[s],!0,t),o}});return e.proxyResult=n,n}function hs(e,t){const{result:n,isUpstream:r}=t,s=Oe(n);s&&(e.depKeys=ye(e.depKeys.concat(s.depKeys)),T(s.nextLevelFnKeys,e.fnKey),T(e.prevLevelFnKeys,s.fnKey),e.isFirstLevel=!1,r==null||r())}function iu(e){var I,R;const{scopeType:t=cu,fnCtxBase:n,isAsyncTransfer:r=!1,asyncType:s=ps,returnUpstreamResult:o,runAsync:c=!0,forAtom:a=!1,immediate:u}=e;if(!F(e.fn))throw new Error("ERR_NON_FN: derive need fn arg!");const{fn:i=w,deps:l=w,task:f}=e,d=K=>{const _=Y(l);return K.isFirstCall&&_.forEach(k=>hs(p,{result:k})),i(N(b({},K),{input:_}))},y=(I=e.isAsync)!=null?I:F(f),m=(R=e.showLoading)!=null?R:y,p=zr(d,{specificProps:{forAtom:a,scopeType:t,fnType:Uo,task:f,deps:l,isAsync:y,asyncType:s,isAsyncTransfer:r,showLoading:m},fnCtxBase:n});Wr(p.fnKey,0);let g=d({isFirstCall:!0,prevResult:null,triggerReasons:[]});Se();const v=Oe(g);a&&!v&&(g={val:g,z__is_atom_result__:!0});const S=p.fnKey;ys(p,g),hs(p,{result:g,isUpstream:()=>{p.returnUpstreamResult=o!=null?o:!y}}),Jt(p),p.returnUpstreamResult||Er(g,t,S);const D=c&&s===ps&&(u!=null?u:!e.fn);return f&&D&&Ne(S,{isFirstCall:!0,sn:p.renderInfo.sn+1}).then(K=>{ys(p,K[0],a)}).catch(K=>oe(K)),p.result=g,t===au&&Jr(p)&&p.setLoading(!0),p.returnUpstreamResult?p.proxyResult=g:uu(p,a),p}function hn(e,t){const n=F(e)?{fn:e}:e||{};return iu(b(b({},t||{}),n))}function gs(e){return hn(e,{forAtom:!0}).proxyResult}function fu(e){return hn(e).proxyResult}function lu(e){return t=>N(b({},t),{deps:e})}function du(e){return e}var ht=e=>[e.snap,e.err];function gn(e){const{target:t,desc:n="",forTask:r=!1,throwErr:s}=e,{mutateFnDict:o,snap:c}=V(t),a=n||Xe,u=o[a];if(!u)return{snap:c,err:new Error(`mutate fn ${a} not defined`),result:null};if(r&&!u.task)return{snap:c,err:new Error(`mutate task ${a} not defined`),result:null};const i={sn:0,fnItem:u,from:B.MUTATE,throwErr:s};return r?pn(t,i):is(t,i)}function ms(e,t,n,r){return{run:s=>{const o=gn({target:e,desc:t,throwErr:s});return ht(o)},runTask:s=>Promise.resolve(gn({target:e,desc:t,forTask:!0,throwErr:s})).then(ht),desc:t,oriDesc:n,getSnap:()=>r.snap,snap:r.snap,__sharedKey:r.sharedKey}}function pu(e){const{target:t,fnItem:n,label:r}=e,s=le(t,{label:r}),o=ss(n,"",s.mutateFnDict);if(!o)throw new Error("not a fn or fnItem { fn }");s.mutateFnDict[o.desc]=o,o.enabled=s.enableMutate;const c={[o.desc]:o};return s.enableMutate&&yn({target:t,dict:c}),ms(t,o.desc,o.oriDesc,s)}function yu(e){const{target:t,fnDict:n,label:r}=e,s=le(t,{label:r}),o=os(n,s.mutateFnDict,s.enableMutate);s.enableMutate&&yn({target:t,dict:o});const c={};return Object.keys(o).forEach(a=>{c[a]=ms(t,a,a,s)}),c}function hu(e,t){const{label:n,descOrOptions:r,forTask:s=!1}=t,{desc:o,strict:c,throwErr:a}=qa(r);return o?Yr(e,{label:n,strict:c})?{ok:!0,desc:o,forTask:s,throwErr:a,err:null}:{ok:!1,desc:o,forTask:s,throwErr:a,err:new Error("not a valid atom or shared result")}:{ok:!1,desc:o,forTask:s,throwErr:a,err:new Error("miss desc")}}function Es(e,t){const{ok:n,desc:r,forTask:s,err:o,throwErr:c}=hu(e,t);if(!n){if(c)throw o;return s?Promise.resolve([e,o]):[e,o]}const a=gn({target:e,desc:r,forTask:s,throwErr:c});return s?Promise.resolve(a).then(ht):ht(a)}function vs(e,t){return Es(e,{descOrOptions:t,label:"runMutate"})}function Ss(e,t){return Es(e,{descOrOptions:t,label:"runMutateTask",forTask:!0})}function Ks(e){return t=>pu({target:e,fnItem:t,label:"mutate"})}function mn(e){return t=>yu({target:e,fnDict:t,label:"mutateDict"})}function As(e,t,n={}){const{tuple:r}=ut(e,t,n);return r}function Ds(e,t,n={}){const{tuple:r}=ut(e,t,n),[s,o,c]=r;return N(b({},c),{state:s,setState:o})}var gu="ERR_NOT_DERIVED_RESULT: useDerived only accept derived result",mu="ERR_NOT_ATOM_RESULT: useDerivedAtom only accept derived atom";function Eu(e,t,n){return e.isExpired?(e.isExpired=!1,!0):F(n)?!1:n!==t}function vu(e){an(e),e.depKeys.length=0,e.prevLevelFnKeys.length=0,e.renderInfo.sn+=1}function Su(e,t){const{result:n,forAtom:r,showLoading:s}=t,{fnCtx:o,input:c,deriveFn:a}=e;let u=!1;if(a)if(Eu(o,c,n))u=!0,vu(o);else return;e.input=n;const i=Oe(n);if(!i)throw new Error(gu);if(r&&!ae(n))throw new Error(mu);e.deriveFn=()=>i.result,hn({fn:()=>i.result,deps:()=>[],task:()=>fo(this,null,function*(){return i.result})},{isAsync:i.isAsync,scopeType:q.HOOK,fnCtxBase:o,isAsyncTransfer:!0,runAsync:!1,returnUpstreamResult:!0,forAtom:r,asyncType:Je.MAY_TRANSFER,showLoading:s}),Nr(o),u&&o.updater()}function _s(e,t){const{result:n,forAtom:r}=t,{hookImpl:s,react:o}=e,c=s.useForceUpdate(),{current:a}=o.useRef({input:n,deriveFn:null,fnCtx:null});a.fnCtx||(a.fnCtx=it({updater:c,scopeType:q.HOOK,forAtom:r}));const u=a.fnCtx;return u.renderStatus=Re,Su(a,t),u}function Ku(e,t){t.shouldReplaceResult&&(Nr(t),t.shouldReplaceResult=!1),at(e,t.subscribe,()=>Ir(t)),e.react.useEffect(()=>{t.renderStatus=Mt})}function Rs(e,t){e.react.useEffect(()=>(t.mountStatus=ze,br(t),()=>{an(t)}),[t])}function En(e,t){const n=_s(e,t);return at(e,n.subscribe,()=>Ir(n)),Rs(e,n),n}function Au(e,t){const n=_s(e,t);return Ku(e,n),Rs(e,n),n}function vn(e,t,n){const r=Au(e,b({result:t},n||{})),{proxyResult:s,status:o,renderInfo:c}=r;return[ae(t)?s.val:s,o,c]}function Ts(e,t,n){if(t===null)return n;if(!F(t))return null;const{sharedState:r,forAtom:s}=e,o=s?r.val:r,c={};Bt.set(u=>c[u[0]]=1);const a=Y(t,o);return Bt.del(),a.includes(o)?e.key2InsKeys:c}function bs(e,t,n){const r=le(t),[s]=e.react.useState(()=>Ts(r,n,null));return o=>{const{insCtxMap:c,key2InsKeys:a}=r,u=Ts(r,o,a)||s||a,i={};if(Object.keys(u).forEach(f=>{(a[f]||[]).forEach(y=>i[y]=1)}),Object.keys(i).length){r.sn+=1;const f=r.sn;Object.keys(i).forEach(d=>{ln(c,Number(d),f)})}}}function Du(e,t){Dn(e);const n=en();return on(e,n,{collectType:"no",globalId:t}).renderInfo}var{ACTION:Is,MUTATE:Ms}=B;function Sn(e,t){Dn(e);const{target:n,from:r="Mutate"}=t||{};let s=Hr();n&&(s=le(n));const{loadingProxy:o,loadingState:c}=xe(re,{apiCtx:e,internal:s,from:r});return{loadingProxy:o,loadingState:c,internal:s,from:r}}function ws(e,t){const{loadingProxy:n,internal:r,from:s}=Sn(e,t),{proxyState:o,extra:c,renderInfo:a}=on(e,n);return[de(c,o,s),r.setState,a]}function _u(e,t){const{loadingProxy:n}=Sn(e,{target:t,from:Ms});return n}function Ru(e,t){return ws(e,{target:t,from:Ms})}function Tu(e,t){const{loadingProxy:n}=Sn(e,{target:t,from:Is});return n}function bu(e,t){return ws(e,{target:t,from:Is})}function Fs(e){return e.hookImpl.useForceUpdate()}function ks(e,t){const n=(r,s)=>{let o=null;if(F(r)){const c=(0,G.P2)(s),a=r(c);o=(0,G._x)(c),j(a)&&Object.assign(o,a)}else j(r)&&(o=b(b({},s),r));return o};return e.hookImpl.useObjectLogic(t,n,!0)}function Iu(e,t,n){const{useRef:r,useMemo:s,useEffect:o}=e.react,c=r({fn:n,wrap:null});c.current.fn=s(()=>n,[n]),c.current.wrap||(c.current.wrap=(...a)=>{c.current.fn(...a)}),o(()=>{const a=rc(),u=c.current.wrap;return a.on(t,u),()=>a.off(t,u)},[t,c])}function Kn(e,t,n={}){const r=Te(t),{insCtx:s}=ut(e,t,N(b({},n),{forAtom:r,isReactive:!0}));return[s.proxyStateVal,s.proxyState,s.renderInfo]}function Cs(e,t,n={}){const[r,s,o]=Kn(e,t,n);return N(b({},o),{state:r,stateRoot:s})}function Mu(e,t,n){const r=j(n)?n:{};e.react.useEffect(()=>{const{srvRef:s}=r;F(s)&&s(t)},[])}function wu(e,t,n){const r=e.hookImpl.useStable(t);return Mu(e,r,n),r}function Fu(e){return t=>e.current=t}var{HOOK:Os}=q;function Ls(e,t){e(()=>{var n,r;return t.mountStatus=ze,br(t),(r=(n=t.extra).deferedWatch)==null||r.call(n),()=>{an(t)}},[t])}function ku(e,t,n){const{useState:r,useEffect:s}=e.react,[o]=r(()=>it());if(o.fn===w){const{manualDepKeys:c=[]}=n;yt(t,{scopeType:Os,fnCtxBase:o,deps:()=>c.map(u=>{const{sharedKey:i,keyPath:l}=Sr(u),f=yc(i);return ce(f,l)}),isSimpleWatch:!0})}Ls(s,o)}function Cu(e,t,n){const{useRef:r,useState:s,useMemo:o,useEffect:c}=e.react,a=r({fn:t,wrap:null}),[u]=s(()=>it());if(a.current.fn=o(()=>t,[t]),!a.current.wrap){const{deps:i,immediate:l}=cs(n);a.current.wrap=f=>{u.mountStatus===ze?a.current.fn(f):u.extra.deferedWatch=()=>a.current.fn(f)},yt(a.current.wrap,{scopeType:Os,fnCtxBase:u,deps:i,immediate:l,label:"useWatch"})}Ls(c,u)}function Ou(e){const{internal:t,setFactoryOpts:n}=e,{rawState:r,forAtom:s,stopDepth:o,sharedKey:c}=t,a=Ct(n),u=b({},r),i=(y,m,p,g)=>{const v=we(m,p,{parentType:Dr(y),parentKeyPath:g});qr(v,{internal:t,mutateCtx:a}),On(u,v.fullKeyPath,p)},l=(y,m,p)=>be(y,{set:(g,v,S)=>(i(g,v,S,p),!0),get:(g,v)=>{const S=g[v];if($e.includes(v))return ct(m===1,s,c,v,S);const D=we(v,S,{isChanged:!1,parentKeyPath:p,op:"get",parentType:Dr(g)});return m<o&&fe(S)?l(S,m+1,D.fullKeyPath):ce(u,D.fullKeyPath)}}),f=l(u,1,[]);nt.set(f,s),Ht.set(a);const d=s?f.val:f;return{draftRoot:f,draftNode:d,finishMutate(y,m={}){rs(a,m);const p=b({state:{},mutateCtx:a},e);ns(p,f,d,y)}}}function Lu(e){let t=e;if(e){e.persist&&e.persist();const{currentTarget:n}=e;n&&e.type?n.tagName==="INPUT"&&n.type==="checkbox"?t=n.checked:t=n.value:e.nativeEvent&&e.target&&(t=e.target.value)}return t}function Pu(e){let t=[];return{target:xc(e,({fullKeyPath:r})=>{t=r}),getPath:()=>t}}function Ps(e,t,n){return s=>{let o=Lu(s);e(c=>{const{isAtom:a,draftRoot:u}=nt.current(),i={draft:c,draftRoot:u,path:t,isAtom:a,UNDEFINED:Oo},l=n==null?void 0:n(o,i);On(u,t,l!==void 0?l:o)},{from:B.SYNC})}}function An(e,t){const{sharedKey:n,innerSetState:r}=t;let s=H(e,n),o=xs.get(s);return o||(o=Ps(r,e),xs.set(s,o)),o}var xs=new Map;function Ns(e){const{forAtom:t,rawState:n}=e;return t?Fn(n.val)?be(n.val,{get:(r,s)=>An(["val",s],e)}):An(["val"],e):be(n,{get:(r,s)=>An([s],e)})}var Us=new Map;function Vs(e){const{forAtom:t,sharedKey:n,innerSetState:r,rawState:s}=e,o=Pu(s);return(c,a)=>{let u=[];if(Array.isArray(c))u=t?["val",...c]:c;else{const{target:f,getPath:d}=o;c(t?f.val:f),u=d()}let i=H(u,n);a&&(i+=`${a.toString()}`);let l=Us.get(i);return l||(l=Ps(r,u,a),Us.set(i,l)),l}}function xu(e,t){const{deep:n,forAtom:r,sharedKey:s}=t,o=Qa(t),c=At(n),a=(g={})=>{const v={internal:p,setFactoryOpts:g},{finishMutate:S,draftRoot:D,draftNode:I}=c?Xa(v):Ou(v);return{finish:(R,K={})=>{const _=p.snap;if(R===_)return _;const k=Uc(r,R,I);return S(k,K),p.snap},draftRoot:D,draftNode:I}},u=(g={})=>a(g),i=(g,v={})=>a().finish(g,v),l=(g,v)=>{const[S,D,I]=v;return nn(e,ke.current(s)),a({handleCbReturn:S,enableDep:D}).finish(g,za(I))},p=ir(t,{sharedState:e,setState:(g,v)=>l(g,[!0,!0,v]),setDraft:(g,v)=>l(g,[!1,!0,v]),insSetState:(g,v)=>l(g,[!0,!1,v]),insSetDraft:(g,v)=>l(g,[!1,!1,v]),setStateFactory:u,innerSetState:i,ruleConf:o,isDeep:c});return p.sync=Vs(p),p.syncer=Ns(p),fc(e,p),p}function Nu(e,t){const n=Za(e,t),{sharedRoot:r,sharedState:s}=$c(n),o=xu(r,n);hc(r,n),kc(),yn({target:r,dict:n.mutateFnDict});const{draft:c,draftRoot:a}=rn(o,{isTop:!0});return o.reactive=c,o.reactiveRoot=a,ic(n.moduleName,o.loc),Fa(o.usefulName),nc(o),{sharedRoot:r,sharedState:s,internal:o,parsedOptions:n}}var{USER_STATE:Ys}=J,{MUTATE:Uu,ACTION:Bs}=B;function Dn(e,t){Ys===(t||Ys)&&!en()&&(Xc(e,re),ba(e,re))}function Gs(e,t){const{createFn:n,ldAction:r,actionDict:s,actionCreator:o,internal:c,apiCtx:a,forTp:u=!1}=e;xe(n,{internal:c,from:Bs,apiCtx:a});const i={},l={};return Object.keys(s).forEach(f=>{const d=s[f],y=u?d.__task:d,m=o(!1)(y,f,t);m.__fnName=f,l[f]=m;const p=(...g)=>{const v=m(...g);return ru(y)?Promise.resolve(v).then(S=>S.result):v.result};p.__fnName=f,i[f]=p}),{actions:i,eActions:l,getLoading:()=>r.getLoading(i),useLoading:()=>r.useLoading(i)[0],useLoadingInfo:()=>r.useLoading(i)}}function Hs(e){const{state:t,ldMutate:n,mutateFnDict:r}=e,s=mn(t)(r);return{witnessDict:s,getLoading:()=>n.getLoading(s),useLoading:()=>n.useLoading(s)[0],useLoadingInfo:()=>n.useLoading(s)}}function Vu(e){const{apiCtx:t,ldMutate:n,inital:r,mutateFnDict:s}=e,[o,,c]=_n(t,r),a=Hs({state:o,ldMutate:n,mutateFnDict:s});return b({derivedState:o,useDerivedState:i=>{const[l,,f]=c.useState(i);return[l,f]}},a)}function Yu(e){const{apiCtx:t,deriveFnDict:n,throwErr:r}=e,s={},o={};return Object.keys(n).forEach(a=>{const u=gs(n[a]);s[a]=u,o[a]={runDerive:i=>Va(u,i!=null?i:r),runDeriveTask:i=>Ya(u,i!=null?i:r),useDerived:i=>vn(t,u,i)[0],useDerivedInfo:i=>vn(t,u,i)}}),{result:new Proxy(s,{get:(a,u)=>s[u].val}),helper:o}}function Bu(e,t){if(t.enableMutate=e,e){const{mutateFnDict:n}=t,r={};Object.keys(n).forEach(s=>{const o=n[s];o.enabled||(o.enabled=!0,r[s]=o)}),mn(t.sharedState)(r)}}function Gu(e){const{moduleName:t,deep:n,recordLoading:r,stopDepth:s,stopArrDep:o,alertDeadCycleErr:c,checkDeadCycle:a,enableMutate:u}=e;return{moduleName:t,deep:n,recordLoading:r,stopDepth:s,stopArrDep:o,alertDeadCycleErr:c,checkDeadCycle:a,enableMutate:u}}function re(e,t){const{stateType:n,apiCtx:r}=e;Dn(r,n);const{sharedRoot:s,sharedState:o,internal:c}=Nu(e,t),{syncer:a,sync:u,forAtom:i,setState:l,setDraft:f,sharedKey:d,sharedKeyStr:y,rootValKey:m,reactive:p,reactiveRoot:g}=c,v=ds(s),S=v(),D={internal:c,from:Uu,apiCtx:r},I=re,R=Xr(I,N(b({},D),{from:Bs})),K=Xr(I,D),_={createFn:I,internal:c,apiCtx:r},k=N(b({},_),{ldAction:R,actionCreator:v});return{state:s,stateRoot:s,stateVal:o,setState:l,setDraft:f,setEnableMutate:E=>Bu(E,c),getOptions:()=>Gu(c),setOnReadHook:E=>c.onRead=E,defineActions:E=>M=>Gs(N(b({},k),{actionDict:M}),E),defineTpActions:E=>M=>Gs(N(b({},k),{actionDict:M,forTp:!0}),E),defineMutateDerive:E=>M=>Vu(N(b({},_),{ldMutate:K,inital:E,mutateFnDict:M})),defineMutateSelf:()=>E=>Hs({ldMutate:K,state:s,mutateFnDict:E}),defineFullDerive:E=>M=>Yu({apiCtx:r,deriveFnDict:M,throwErr:E}),mutate:Ks(s),runMutate:E=>vs(s,E),runMutateTask:E=>Ss(s,E),action:v,call:(E,M,A,h)=>S(E,A,h)(M),useState:E=>As(r,s,E),useStateX:E=>Ds(r,s,E),useForceUpdate:E=>bs(r,s,E),useLocalState:E=>ks(r,E),useLocalForceUpdate:()=>Fs(r),getMutateLoading:K.getLoading,useMutateLoading:K.useLoading,getActionLoading:R.getLoading,useActionLoading:R.useLoading,getSnap:E=>ur(s,E),sync:u,syncer:a,sharedKey:d,sharedKeyStr:y,rootValKey:m,reactive:p,reactiveRoot:g,reactiveDesc:E=>Cr(s,E),useReactive:E=>Kn(r,s,E),useReactiveX:E=>Cs(r,s,E),flush:E=>nn(s,E),isAtom:i}}function _n(e,t,n){const r=re({apiCtx:e,rawState:t},n);return[r.state,r.setState,r]}function Hu(e,t,n){return re({apiCtx:e,rawState:t},n)}function ju(e,t,n){const r=re({apiCtx:e,rawState:t,forAtom:!0},n);return[r.state,r.setState,r]}function $u(e,t,n){return re({apiCtx:e,rawState:t,forAtom:!0},n)}function js(e,t){const{label:n,isSyncer:r}=t,s=le(e,{label:n});return(r?Ns:Vs)(s)}function Xu(e){return js(e,{label:"sync"})}function Wu(e){return js(e,{label:"syncer",isSyncer:!0})}var zu=100,Ju=5e3;function Zu(e,t){return{key:e,results:[],depKeys:[],enableStatus:t,collected:!1,mounted:!1,renderAtomOnce:!1,time:0,status:{loading:!1,err:null,ok:!0}}}function Qu(e,t=!1){const n=Z();e&&(n.initCount+=1);const r=vc(),s=Zu(r,t);return Mr(e).set(r,s),s}function qu(e){const t=Z();e.mounted=!0,e.time=Date.now(),t.mountedCount+=1}function ei(e,t){const n=Z(),r=Mr(t);if(r.delete(e),t&&r.size===zu&&n.initCount-n.mountedCount>2){n.initCount=0,n.mountedCount=0;const s=Date.now();r.forEach((o,c)=>{!o.mounted&&s-o.time>Ju&&r.delete(c)})}}function ti(e,t){const n=Z();n.runningKey=e.key,n.isDynamic=t}function ni(e){const t=Z();t.runningKey="",t.isDynamic=!1,e.collected=!0}function ri(e,t,n){ku(e,n,{manualDepKeys:t.depKeys})}function $s(e,t,n){let r={loading:!1,err:null,ok:!0};return ri(e,t,n),t.results.forEach(s=>{const o=En(e,{result:s,forAtom:ae(s),showLoading:t.enableStatus});o.status.ok||(r=o.status)}),r}function Xs(e,t,n){e.react.useEffect(()=>(t.mounted||qu(t),()=>{ei(t.key,n)}),[t])}var si=()=>!0,Rn=e=>e;function oi(e){const t=[];for(let n=1;n<=e.length;n++)t.push(e.slice(0,n));return t}function Tn(e,t,n,r,s){const o=t;return o.displayName=n,r?e.react.memo(o,s):o}function Ws(e,t){const{sharedState:n,depKey:r,keyPath:s,compare:o,sharedKey:c,format:a=Rn}=t;return Tn(e,function(){const i=on(e,n,{arrDep:!0});i.isFirstRender&&(s.length>=2?oi(s).forEach(d=>{i.recordDep({sharedKey:c,depKey:H(d,c),keyPath:d,parentKeyPath:d.slice(0,d.length-1)},Ze)}):i.recordDep({sharedKey:c,depKey:r,keyPath:s}));const l=ce(i.internal.rawState,s);return a(l)},"HeluxSignal",!0,o)}function bn(e,t){return Tn(e,function(){const{result:r,format:s=Rn}=t,o=En(e,{result:r,forAtom:!0});return s(o.proxyResult.val)},"HeluxDerivedAtomSignal",!0,t.compare)}function ci(e,t){return Tn(e,function(){const{result:r,keyPath:s,format:o=Rn}=t;return En(e,{result:r,forAtom:!1}),o(ce(r,s))},"HeluxDerivedSignal",!0,t.compare)}function zs(e,t){const{isDynamic:n,cb:r,props:s,ref:o}=t,{collected:c,status:a}=e;c||ti(e,n);const i=r(s,{props:s,status:a,read:po,ref:o})||"";return c||ni(e),i}function Js(e,t,n){const r=ae(n);if(t.renderAtomOnce&&!r)throw new Error("block cb once returned derived atom but not keep to return it in new render period!");if(r){t.renderAtomOnce=!0;const s=bn(e,{result:n});return e.react.createElement(s,{status:{loading:!1,err:null,ok:!0}})}return Xn(n)}function Zs(e,t,n,r){const{memo:s=!0,compare:o}=r||{},{key:c}=t,{react:a}=e,u=a.forwardRef||w,i=n();let l=u(i);se()&&(i.displayName="HeluxKeyedBlockForHMR",l=u((d,y)=>(y&&Eo(y,"current")&&(t.ref=y),a.createElement(i,N(b({},d),{key:c})))));const f=s?a.memo(l,o):l;return f.displayName="HeluxBlock",f[It]=!0,f}function ai(e,t){const{cb:n,isDynamic:r,apiCtx:s,blockCtx:o}=e,{useForceUpdate:c}=s.hookImpl,a=r?Xs:w;return Zs(s,o,()=>(u,i)=>{const l=o.ref||i,f=zs(o,{isDynamic:r,cb:n,props:u,ref:l}),d=c();return $s(s,o,d),a(s,o,r),Js(s,o,f)},t)}function ui(e,t){const{cb:n,isDynamic:r,apiCtx:s,blockCtx:o}=e,c=r?Xs:w,{useForceUpdate:a}=s.hookImpl,{useEffect:u}=s.react;return Zs(s,o,()=>(i,l)=>{const f=o.ref||l,d=zs(o,{isDynamic:r,cb:n,props:i,ref:f}),y=a(),m=$s(s,o,y);c(s,o,r);const p=o.status.loading,g=m.loading;return u(()=>{p!==g&&y()},[p,g]),o.status=m,Js(s,o,d)},t)}function Qs(e,t){const n=eu(t),{enableStatus:r}=n,s=N(b({},e),{blockCtx:Qu(e.isDynamic,r)});return r?ui(s,n):ai(s,n)}function ii(e,t,n){return Qs({apiCtx:e,isDynamic:!1,cb:t},n)}function qs(e,t,n){return Qs({apiCtx:e,isDynamic:!0,cb:t},n)}function eo(e,t,n){const{react:r}=e;if(t&&t[It])return r.createElement(t);const s=si;if(F(t)){const d=qs(e,t,{compare:s});return r.createElement(d)}if(ae(t)){const d=bn(e,{result:t,compare:s,format:n});return r.createElement(d)}if(Te(t)){const d=te(t),y=Kt("val",d),p=Ws(e,{sharedKey:d,sharedState:t,depKey:y,keyPath:["val"],compare:s,format:n});return r.createElement(p)}const o=jc(),{sharedKey:c,val:a,stateOrResult:u,depKey:i,keyPath:l,isDerivedResult:f}=o;if(t===a&&u){if(o.isDerivedAtom){const y=bn(e,{result:u,compare:s,format:n});return r.createElement(y)}if(f){const y=ci(e,{result:u,keyPath:l,compare:s,format:n});return r.createElement(y)}const d=Ws(e,{sharedKey:c,sharedState:u,depKey:i,keyPath:l,compare:s,format:n});return r.createElement(d)}return t}var{shallowCompare:fi,isDiff:li}=G.limuUtils,di=_n,pi=eo,yi={EVENT_NAME:Tt,RECORD_LOADING:bt,VER:Un,LIMU_VER:wo};function to(e,t,n){return t(e,n)}function hi(e,t){return to(e,t)}function gi(e,t){return{build:n=>to(e,t,n)}}var mi=["atom","atomx","share","sharex","getMutateLoading","getActionLoading","$","signal","block","blockStatus","dynamicBlock","dynamicBlockStatus"];function Ei(e){return e.startsWith("use")||mi.includes(e)}function vi(e){return Object.assign({useSyncExternalStore:w},e)}function Si(e,t){const n=bo(e),r=b({},n),s={react:vi(e),hookImpl:n,act:t};t&&(n.useForceUpdate=()=>{const[,a]=e.useState({});return()=>t(()=>a({}))});const o=Nn;return Object.keys(o).forEach(a=>{const u=o[a];Ei(a)?r[a]=u.bind(null,s):r[a]=u}),Object.assign({model:a=>hi(r,a),modelFactory:a=>gi(r,a)},r)}function Ki(e){const{inited:t,API:n}=Wo();if(t)return n;const{heluxCtxKey:r,standalone:s,transfer:o,reactLib:c,act:a}=e,u=W[r],i=(l,f)=>{const d=f||zn(),y=Si(c,a);return qn({ROOT:d,inited:!0,api:y}),W[l]=d,y};if(!u)return i(r);if(s)return i(`${String(r)}_${Date.now()}`);if(o){const l=zn();qn({ROOT:l,inited:!0}),o(u,l)}return i(r,u)}var Ai=C(70079),Di=C.t(Ai,2),no=Ki({heluxCtxKey:"__HELUX__",reactLib:Di}),_i=no.share,{atom:Ri,atomx:Ti,share:bi,sharex:Ii,derive:Mi,deriveDict:wi,defineDeriveTask:Fi,defineDeriveFnItem:ki,runDerive:Ci,runDeriveTask:Oi,watch:Li,useAtom:Pi,useAtomX:xi,useReactive:Ni,useReactiveX:Ui,useDerived:Vi,useWatch:Yi,useGlobalId:Bi,useService:Gi,useOnEvent:Hi,useMutable:ji,useMutateLoading:$i,useActionLoading:Xi,useEffect:Wi,useLayoutEffect:zi,useStable:Ji,useObject:Zi,useLocalForceUpdate:Qi,useGlobalForceUpdate:qi,action:ef,signal:tf,block:nf,dynamicBlock:rf,$:sf,mutate:of,mutateDict:cf,runMutate:af,runMutateTask:uf,sync:ff,syncer:lf,model:df,modelFactory:pf,emit:yf,on:hf,init:gf,reactiveDesc:mf,flush:Ef,isAtom:vf,isDerivedAtom:Sf,storeSrv:Kf,shallowCompare:Af,markRaw:Df,isDiff:_f,produce:Rf,getMutateLoading:Tf,getActionLoading:bf,getDeriveLoading:If,getRawState:Mf,getSnap:wf,getAtom:Ff,addMiddleware:kf,addPlugin:Cf,cst:Of}=no}}]);
}());